(self.webpackChunkkostki=self.webpackChunkkostki||[]).push([[179],{368:(t,e,n)=>{"use strict";n.d(e,{nS:()=>ke,$z:()=>Be,Ah:()=>Me});var a,r,o=n(385),i=function(){return(i=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},c=function(t,e){return e.find((function(e){return e.name===t}))};(r=a||(a={})).box="box",r.ai="ai",r.game="game",r.camera="camera",r.marker="marker";var u,s=function(t){var e,n,a=t.state,r=t.data,o=i(i({},a),{component:i(i({},a.component),(e={},e[r.name]=i(i({},a.component[r.name]),(n={},n[r.entity]=r,n)),e))}),u=c(r.name,a.system);if(void 0!==u){if(void 0===a.component[r.name]||void 0===a.component[r.name][r.entity])return u.create({state:o,component:r});if(u.update)return u.update({state:o,component:r})}return o},p=function(t){var e=t.state,n=t.name,a=f({state:e,name:n});return a?Object.keys(a).reduce((function(t,e){return function(t){var e,n=t.name,a=t.entity,r=t.state,o=r.component[n],u=a,s=(o[u],function(t,e){var n={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.indexOf(a)<0&&(n[a]=t[a]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(t);r<a.length;r++)e.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(t,a[r])&&(n[a[r]]=t[a[r]])}return n}(o,["symbol"==typeof u?u:u+""])),p=i(i({},r),{component:i(i({},r.component),(e={},e[n]=s,e))}),f=d({name:n,state:r,entity:a}),l=c(n,p.system);return l&&f?l.remove({state:p,component:f}):p}({name:n,entity:e,state:t})}),e):e},d=function(t){var e=t.name,n=t.entity,a=t.state.component[e];return a?a[n]:void 0},f=function(t){var e=t.name;return t.state.component[e]},l=function(t){var e=t.entity,n=t.name,a=function(t){var a=t.state;return d({state:a,entity:e,name:n})};return{getComponent:a,setComponent:function(t){var r=t.state,o=t.data,c=a({state:r});return c?r=s({state:r,data:i(i({entity:e,name:n},c),o)}):r}}},m=function(){return(m=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},y=function(t,e){for(var n=0,a=e.length,r=t.length;n<a;n++,r++)t[r]=e[n];return t};!function(t){t[t.last=3]="last",t[t.time=3]="time",t[t.io=2]="io",t[t.transform=1]="transform",t[t.zero=0]="zero",t[t.sprite=-1]="sprite",t[t.draw=-2]="draw"}(u||(u={}));var v,b,g=function(t){return t.state},h=function(t){var e=t.state,n=t.tick,a=function(t,e){var n={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.indexOf(a)<0&&(n[a]=t[a]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(t);r<a.length;r++)e.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(t,a[r])&&(n[a[r]]=t[a[r]])}return n}(t,["state","tick"]),r={name:a.name,priority:a.priority||u.zero,initialize:a.initialize||g,create:a.create||g,tick:function(t){var e=t.state,r=t.eventBuffer,o=e.component[a.name];return o?Object.values(o).reduce((function(t,e){var o=function(t){var e=t.entity,n=t.eventBuffer,a=t.state,r=t.eventHandler,o=t.component;return n[e]?n[e].reduce((function(t,n){if(r){var a=d({state:t,entity:e,name:o.name});return a?r({state:t,event:n,component:a}):t}return t}),a):a}({eventHandler:a.event,state:t,eventBuffer:r,entity:e.entity,component:e});return n?n({state:o,component:e}):o}),e):e},update:a.update,remove:a.remove||g,event:a.event||g};return m(m({},e),{system:y(y([],e.system),[r])})},x=function(t){var e=t.getEngine().getRenderingCanvasClientRect();return null!==e?e.height/e.width:1},O=function(t,e){var n=x(e),a=e.activeCamera;a&&(n>1?(a.orthoLeft=-t,a.orthoRight=t,a.orthoBottom=a.orthoLeft*n,a.orthoTop=a.orthoRight*n):(a.orthoBottom=-t,a.orthoTop=t,a.orthoLeft=a.orthoBottom/n,a.orthoRight=a.orthoTop/n))},w="cameraEntity",C=l({entity:w,name:a.camera}),A=(C.getComponent,C.setComponent),T=1.2,P=function(t){var e=t[0]?1.2*t[0].length:1,n=1.2*t.length;return{center:[(e-1-.2)/2,(n-1-.2)/2],cameraDistance:(e>n?e:n)/2+.2}},E=function(){return(E=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},I="first",B={},S={},M=function(t){"first"===I?(B[t.entity]||(B[t.entity]=[]),B[t.entity].push(t)):(S[t.entity]||(S[t.entity]=[]),S[t.entity].push(t))},k={entity:{},component:(v={},v[a.box]={},v[a.ai]={},v[a.game]={},v[a.camera]={},v[a.marker]={},v),system:[]};!function(t){t[t.mainMenu=0]="mainMenu",t[t.customLevel=1]="customLevel"}(b||(b={})),n(290);const L=n.p+"8b1469fe19d1d6c3811ef4ef5c6df926.png";var R,N=function(){return(N=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};!function(t){t.Type||(t.Type={})}(R||(R={}));var j,V=function(t,e,n){return t&&t[n]?t[n][e]:void 0},U=0,q=10,G=-10,D=-5,Q=-4,z=-15,Y=50,_=0,H=1,F=2,K=7,J=-5,W=-4,$=0,X=0;!function(t){t[t.less=-1]="less",t[t.equal=0]="equal",t[t.more=1]="more"}(j||(j={}));var Z=function(t){var e=t.state,n=xe({state:e});return n?n.grid.reduce((function(t,n){var r=d({name:a.box,state:e,entity:n});if(r){var o=r.gridPosition[0],i=r.gridPosition[1];t[o]||(t[o]=[]),t[o][i]=N(N({},r),{points:0})}return t}),[]):[]},tt=function(t){var e=t.dataGrid,n=t.currentPlayer;return e.reduce((function(t,a,r){return t[r]=a.reduce((function(t,a,o){if(a.player!==n&&void 0!==a.player)return t;var i=[[V(e,o-1,r-1),V(e,o,r-1),V(e,o+1,r-1)],[V(e,o-1,r),V(e,o,r),V(e,o+1,r)],[V(e,o-1,r+1),V(e,o,r+1),V(e,o+1,r+1)]],c=function(t){var e=t[1][1];return function(t){return[t[1][0],t[0][1],t[1][2],t[2][1]]}(t).reduce((function(t,n){if(!n)return t+_;var a=e.dots===n.dots?j.equal:e.dots>n.dots?j.more:j.less;if(n.player!==e.player&&void 0!==n.player){if(a===j.more){var r=e.dots-n.dots;return t+U-r}if(a===j.equal)return t+q*e.dots;if(a===j.less)return r=n.dots-e.dots,t+G*r}else{if(6===e.dots)return t;if(a===j.more)return t+D;if(a===j.equal)return 6===n.dots&&6===e.dots?t+Y:t+Q;if(a===j.less)return 6===n.dots?t+2*z:t+z}return t}),0)}(i)+function(t){var e=t[1][1];return function(t){return[t[0][0],t[0][2],t[2][0],t[2][2]]}(t).reduce((function(t,n){if(!n)return t+X;var a=e.dots===n.dots?j.equal:e.dots>n.dots?j.more:j.less;if(n.player!==e.player&&void 0!==n.player){if(a===j.more)return t+H;if(a===j.equal)return 6===n.dots?t+-10*F:t+F;if(a===j.less)return 6===n.dots?t+2*K:t+K}else{if(6===e.dots)return t;if(a===j.more)return t+J;if(a===j.equal)return t+W;if(a===j.less){var r=n.dots-e.dots;return t+$+Math.pow(r,2)}}return t}),0)}(i);return t[o]=N(N({},a),{points:a.points+c}),t}),a),t}),e)},et=function(t){var e=t.state,n=t.ai,a=t.preferEmptyBoxes,r=n.entity,o=Z({state:e});return o=function(t){var e=t.dataGrid,n=t.preferEmptyBoxes;return e.reduce((function(t,e,a){return t[a]=e.reduce((function(t,e,a){var r=void 0===e.player,o=n?100:0,i=r?e.points+50+o:e.points;return t[a]=N(N({},e),{points:i}),t}),e),t}),e)}({dataGrid:o,preferEmptyBoxes:!!a}),function(t){var e=t.currentPlayer,n=-1/0,a=[];t.dataGrid.forEach((function(t){t.forEach((function(t){var r=void 0===t.player,o=t.player===e;(r||o)&&(t.points>n&&(a=[]),t.points>=n&&(n=t.points,a.push(t)))}))}));var r=Math.floor(Math.random()*a.length);return a[r]}({currentPlayer:r,dataGrid:o=tt({currentPlayer:r,dataGrid:o})})};const nt=n.p+"57365b6b32a38acad399fa24be970b62.png",at=n.p+"86711768640182ba9774e66c59e43713.png",rt=n.p+"d5fd50f6577249e4bd0a6cedc07b855c.png",ot=n.p+"1cece826ef3290f02e8ab121defa70e5.png",it=n.p+"04486ea103fd49156ce128e43c00f4af.png",ct=n.p+"4c8888485f10730f523694c6ac7449e4.png",ut=n.p+"3bb45fa09a5eb9cd805c7f32aab31591.png",st=n.p+"289b33e3a3e1c125f813747944282bbb.png",pt=n.p+"e7015b6db11decc2aa7f722b6eaaa343.png",dt=n.p+"7e6aabd8e3d92edca81c0207761816f0.png",ft=n.p+"1a202abfbdfbb945f566e890f0e0fa7f.png",lt=n.p+"ad7c3be816ce34c76152ecc6c61d263b.png",mt=n.p+"8711d0d55135c6a04bf3e76aa6287504.png",yt=n.p+"717e6eb5fb82bedfc88f6dc0c65b6f12.png",vt=n.p+"16c7f9cc6c2acada16547b3befe94a91.png",bt=n.p+"2d2b2519ce6d9ed0c93cd7ed21aed043.png",gt=n.p+"7fa7abdc3e479f97ee5f6b283630df03.png",ht=n.p+"f3941c38549dddc4a8cb586591e36996.png",xt=n.p+"62bd7e3778d77e5ca308fcb5f4b0da78.png",Ot=n.p+"2f30a46bdc58014e8ba857f895bbe5b8.png",wt=n.p+"de0b87223c2e5708366657b7da01c941.png",Ct=n.p+"54b2699e76fca159c5797b2b93b10bd4.png",At=n.p+"3d713800c02422e02fe02e70f53e9771.png",Tt=n.p+"2f9682e3f7d362cc3087ef4dcbbdfd2b.png",Pt=n.p+"62f6adca2ae3c6e088aac66bc47cb54e.png",Et=n.p+"9bb2d886948bbd78603ec224904774fd.png",It=n.p+"2d9f8ec02b7087dc45bf61208aacf7a8.png",Bt=n.p+"4fd5888696b352601fd6c1f7a1420e1f.png",St=n.p+"d62f41f971620bf90529571efed25c8e.png",Mt=n.p+"2c7434786497b8ccb02757089a53015a.png",kt=n.p+"51f16b6b18086fcc295f8bc02e6c8c45.png",Lt=n.p+"0dfd6a6b5e5120be13c81ddc1d84a1df.png",Rt=n.p+"301a367840edef78b86808852d0c067e.png",Nt=n.p+"d854a7c9f810ebe5be07e17990bd0ee4.png",jt=n.p+"777079c111d24a4a0402f5afbc95b175.png",Vt=n.p+"e1b39772fd20282e80743b1f04be6795.png",Ut=n.p+"24075b75ce25b7869e6559cccca76b75.png";n.p,n.p,n.p,n.p,n.p,n.p,n.p,n.p,n.p,n.p,n.p,n.p;var qt,Gt,Dt=[nt,at,rt,ot,it,ct,ut],Qt=[nt,st,pt,dt,ft,lt,mt],zt=[nt,yt,vt,bt,gt,ht,xt],Yt=[nt,Ot,wt,Ct,At,Tt,Pt],_t=[nt,Et,It,Bt,St,Mt,kt],Ht=[nt,Lt,Rt,Nt,jt,Vt,Ut],Ft=function(t){var e=t.mesh,n=t.texture,a=t.scene,r=t.color;e.material.diffuseColor=new o.Color3(r[0],r[1],r[2]);var i=new o.Texture(n,a,void 0,void 0,o.Texture.NEAREST_NEAREST_MIPLINEAR);return e.material.diffuseTexture=i,i},Kt=function(){return(Kt=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},Jt=function(t,e){for(var n=0,a=e.length,r=t.length;n<a;n++,r++)t[r]=e[n];return t};!function(t){t[t.up=0]="up",t[t.down=1]="down",t[t.left=2]="left",t[t.right=3]="right"}(qt||(qt={})),function(t){var e;(e=t.Type||(t.Type={}))[e.onClick=0]="onClick",e[e.rotationEnd=1]="rotationEnd",e[e.rotate=2]="rotate"}(Gt||(Gt={}));var Wt=function(t){return t>2*Math.PI||t<-2*Math.PI?-2*Math.PI:t},$t=function(t){var e=t.state,n=t.ai,a=xe({state:e});return n&&(null==a?void 0:a.colorBlindMode)?n.textureSet:Dt},Xt=function(t){var e=t.entity,n=t.state,a=xe({state:n});return a?s({state:n,data:Kt(Kt({},a),{boxRotationQueue:Jt(Jt([],a.boxRotationQueue),[e])})}):n},Zt=function(t){var e=t.entity,n=t.animationEndCallback,a=(t.direction,t.color),r=t.texture,i=Me.getTransformNodeByUniqueId(parseInt(e));if(i){var c=o.Tools.ToRadians(90)*(Math.random()>.5?1:-1),u=Math.random()>.5?"x":"y",s=i.rotation,p=new o.Vector3("x"===u?c:0,"y"===u?c:0,0).add(s),d=new o.Vector3(Wt(p.x),Wt(p.y),Wt(p.z)),f=new o.Animation("rotateAnimation","rotation",1,o.Animation.ANIMATIONTYPE_VECTOR3,o.Animation.ANIMATIONLOOPMODE_RELATIVE),l=new o.AnimationEvent(.5,n,!0);f.addEvent(l);var m=[];m.push({frame:0,value:s}),m.push({frame:.5,value:d}),f.setKeys(m),i.animations[i.animations.length]=f,Me.beginAnimation(i,0,1,!1),i.getChildren().slice(0,-1).forEach((function(t){var e=Me.getMeshByUniqueId(t.uniqueId);e&&Ft({mesh:e,color:a,texture:r,scene:Me})}))}},te=function(t){return 6===t?1:t+1},ee=function(t){var e=t.state,n=t.ai,a=t.box,r=a.entity,o=a.dots;return n&&(o=te(a.dots),Zt({entity:r,animationEndCallback:function(){M({type:Gt.Type.rotationEnd,entity:r,payload:{ai:n,shouldExplode:6===a.dots}})},texture:$t({state:e,ai:n})[o],color:n.color}),e=Xt({entity:r,state:e})),s({state:e,data:Kt(Kt({},a),{isAnimating:!0,player:(null==n?void 0:n.entity)||"",dots:o})})},ne=function(t){var e=t.boxEntity,n=t.texture,a=t.color,r=Me.getTransformNodeByUniqueId(parseInt(e));r&&(r.rotation.x=0,r.rotation.y=0,r.getChildren().forEach((function(t){var e=Me.getMeshByUniqueId(t.uniqueId);e&&Ft({mesh:e,color:a,texture:n,scene:Me})})))},ae=function(t){return h({state:t,name:a.box,create:function(t){var e=t.state,n=t.component,r=n.gridPosition,i=d({state:e,name:a.ai,entity:n.player||""});!function(t){var e=t.scene,n=t.name,a=t.uniqueId,r=t.position,i=t.color,c=t.state,u=t.ai,s=t.box,p=new o.TransformNode("box "+n,e);p.uniqueId=a,p.position.x=r[0],p.position.y=r[1],[[new o.Vector3(-.5,0,0),new o.Vector3(0,Math.PI/2,0)],[new o.Vector3(0,0,.5),new o.Vector3(0,Math.PI,0)],[new o.Vector3(.5,0,0),new o.Vector3(0,-Math.PI/2,0)],[new o.Vector3(0,.5,0),new o.Vector3(Math.PI/2,0,0)],[new o.Vector3(0,-.5,0),new o.Vector3(-Math.PI/2,0,0)],[new o.Vector3(0,0,-.5),new o.Vector3(0,0,0)]].forEach((function(t,n){var r=t[0],d=t[1],f=o.Mesh.CreatePlane("plane"+n,1,e,!0);f.parent=p,f.material=new o.StandardMaterial("mat",e),Ft({mesh:f,color:i,texture:$t({state:c,ai:u})[s.dots],scene:e}),f.material.alpha=1,f.position=r,f.rotation=d,f.setParent(p),f.actionManager=new o.ActionManager(e),f.actionManager.registerAction(new o.ExecuteCodeAction(o.ActionManager.OnPickUpTrigger,(function(){M({entity:ge,type:le.Type.playerClick,payload:{boxEntity:a.toString()}})})))}))}({scene:Me,name:r[0]+"-"+r[1],position:[r[0]*T,r[1]*T],uniqueId:parseFloat(n.entity),texture:(null==i?void 0:i.textureSet[n.dots])||nt,color:(null==i?void 0:i.color)||[1,1,1],ai:i,box:n,state:e});var c=xe({state:e});return c?e=s({state:e,data:Kt(Kt({},c),{grid:Jt(Jt([],c.grid),[n.entity])})}):e},event:function(t){var e=t.state,n=t.component,a=t.event;switch(a.type){case Gt.Type.rotationEnd:return function(t){var e=t.state,n=t.component,a=t.event.payload,r=a.ai,o=a.shouldExplode;e=function(t){var e=t.entity,n=t.state,a=xe({state:n});return a?s({state:n,data:Kt(Kt({},a),{boxRotationQueue:a.boxRotationQueue.filter((function(t){return t!==e}))})}):n}({entity:n.entity,state:e}),ne({boxEntity:n.entity,texture:$t({state:e,ai:r})[n.dots],color:r.color});var i=xe({state:e});if(!i)return e;o?e=function(t){var e=t.state,n=t.ai,a=t.box.gridPosition,r=a[0],o=a[1],i=Z({state:e});return[V(i,o,r-1),V(i,o,r+1),V(i,o-1,r),V(i,o+1,r)].filter((function(t){return void 0!==t})).reduce((function(t,e,a){return t=ee({ai:n,box:e,state:t}),Xt({entity:e.entity,state:t})}),e)}({state:e,box:n,ai:r}):0===i.boxRotationQueue.length&&M({type:le.Type.nextTurn,entity:ge,payload:{ai:r}});var c=Me.getTransformNodeByUniqueId(parseInt(n.entity));return c&&(c.animations=[]),s({state:e,data:Kt(Kt({},n),{isAnimating:!1})})}({state:e,component:n,event:a});case Gt.Type.rotate:return function(t){var e=t.state,n=t.component,a=t.event;return Zt({entity:n.entity,animationEndCallback:function(){ne({boxEntity:n.entity,texture:a.payload.texture,color:a.payload.color})},texture:a.payload.texture,color:a.payload.color}),e}({state:e,component:n,event:a})}}})},re="localDbKey",oe=function(){return(oe=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},ie=[.11,.79,.29],ce=[.09,.84,1],ue=[1,.73,.29],se=[.99,.97,.32],pe=[.99,.42,.45],de=[.99,.47,.94];const fe=n.p+"de1ab0613214552916d369d2014d1d95.png";var le,me="38127445920450264",ye=l({entity:me,name:a.marker}),ve=(ye.getComponent,ye.setComponent),be=function(){return(be=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},ge="game";!function(t){var e;(e=t.Type||(t.Type={}))[e.startCustomLevel=0]="startCustomLevel",e[e.nextTurn=1]="nextTurn",e[e.boxExplosion=2]="boxExplosion",e[e.playerClick=3]="playerClick",e[e.saveGame=4]="saveGame"}(le||(le={}));var he=l({entity:ge,name:a.game}),xe=he.getComponent,Oe=he.setComponent,we=function(t){var e=t.playersQueue,n=t.index,r=t.state,o=d({state:r,name:a.ai,entity:e[n]});return(null==o?void 0:o.active)?o:we({playersQueue:e,index:n>=e.length?0:n+1,state:r})},Ce=function(t){var e=t.state,n=xe({state:e});if(n){var a=n.playersQueue.findIndex((function(t){return n.currentPlayer===t}));return we({playersQueue:n.playersQueue,index:a+1,state:e})}},Ae=function(t){var e=t.state,n=t.component;e=function(t){var e=t.state,n=(t.scene,t.camera,function(t,e,n,r){return void 0===r&&(r=!1),{entity:t,name:a.ai,human:r,level:1,color:e,textureSet:n,active:!0}});e=function(t){var e=t.state,n=t.ai;e=p({state:e,name:a.ai});var r=xe({state:e});return r&&(e=s({state:e,data:oe(oe({},r),{playersQueue:n.map((function(t){return t.entity}))})})),n.reduce((function(t,e){return s({state:t,data:e})}),e)}({state:e=Array.from({length:8}).reduce((function(t,e,n){return Array.from({length:8}).reduce((function(t,e,r){return s({state:t,data:{name:a.box,entity:Math.floor(1e17*Math.random()).toString(),isAnimating:!1,dots:0,gridPosition:[r,n],player:void 0}})}),t)}),e),ai:[n(Be,ce,Dt,!0),n("2",pe,Qt),n("3",ie,zt),n("4",se,Yt),n("5",ue,_t),n("6",de,Ht)]});var r=P(Z({state:e})),o=r.center,i=r.cameraDistance;return A({state:e,data:{position:[o[0],o[1]],distance:i}})}({state:e,scene:Me,camera:ke});var r=d({name:a.ai,state:e,entity:(null==n?void 0:n.currentPlayer)||""}),o=xe({state:e});if(!r||!o)return e;if(e=s({state:e,data:be(be({},o),{gameStarted:!0,currentPlayer:r.entity})}),o.quickStart&&function(t){var e=t.state,n=xe({state:e});n&&n.grid.forEach((function(t){var n=d({state:e,entity:t,name:a.box}),r=d({state:e,entity:(null==n?void 0:n.player)||"",name:a.ai});n&&r&&M({type:Gt.Type.rotate,entity:t,payload:{color:r.color,texture:$t({state:e,ai:r})[n.dots],direction:qt.up}})}))}({state:e=function(t){var e,n=t.state;return(null===(e=xe({state:n}))||void 0===e?void 0:e.grid.reduce((function(t){var e=xe({state:t}),n=d({state:t,name:a.ai,entity:(null==e?void 0:e.currentPlayer)||""});if(!e||!n)return t;var r=et({state:t,ai:n,preferEmptyBoxes:!0});if(!r)return t;t=s({state:t,data:be(be({},r),{player:n.entity,dots:te(r.dots)})});var o=Ce({state:t});return o?t=s({state:t,data:be(be({},e),{currentPlayer:o.entity})}):t}),n))||n}({state:e})}),e=s({state:e,data:be(be({},o),{gameStarted:!0,currentPlayer:r.entity})}),!r.human){var i=et({state:e,ai:r});i&&(e=ee({box:i,state:e,ai:r}))}return e},Te=function(t){return h({state:t,name:a.game,create:function(t){var e=t.state;return t.component.boxRotationQueue.forEach((function(t){var n=d({state:e,name:a.box,entity:t}),r=d({state:e,name:a.ai,entity:(null==n?void 0:n.player)||""});r&&n&&M({type:Gt.Type.rotationEnd,entity:t,payload:{ai:r,shouldExplode:6===n.dots}})})),e},event:function(t){var e=t.state,n=t.component,r=t.event;switch(r.type){case le.Type.startCustomLevel:return Ae({state:e,component:n,event:r});case le.Type.nextTurn:return function(t){var e=t.state,n=t.component,r=n.gameStarted,o=n.boxRotationQueue;if(r&&0===o.length){var i=Ce({state:e});if(!i)return e;var c=d({name:a.ai,state:e,entity:i.entity});if(!c)return e;if(e=s({state:e,data:be(be({},n),{currentPlayer:c.entity})}),!c.human&&c.active){var u=et({state:e,ai:c});if(!u)return function(t){var e=t.state,n=t.ai,r=t.component;e=s({state:e,data:be(be({},n),{active:!1})});var o=f({state:e,name:a.ai});return 1===Object.values(o||{}).reduce((function(t,e){return e.active?t+1:t}),0)?s({state:e,data:be(be({},r),{gameStarted:!1})}):(M({type:le.Type.nextTurn,entity:ge,payload:{ai:n}}),e)}({state:e,component:n,ai:c});e=ve({state:e,data:{color:c.color,position:[u.gridPosition[0]*T,u.gridPosition[1]*T]}}),e=ee({box:u,state:e,ai:c}),e=Xt({state:e,entity:u.entity})}}return function(t){localStorage.setItem(re,JSON.stringify(t))}(e),e}({state:e,component:n,event:r});case le.Type.playerClick:return function(t){var e=t.state,n=t.component,r=t.event,o=n.currentPlayer,i=n.gameStarted,c=n.boxRotationQueue,u=d({state:e,name:a.box,entity:r.payload.boxEntity}),s=void 0===(null==u?void 0:u.player)||(null==u?void 0:u.player)===o;if(i&&0===c.length&&s){var p=d({name:a.ai,state:e,entity:o});u&&(null==p?void 0:p.human)&&(e=ve({state:e,data:{color:p.color,position:[u.gridPosition[0]*T,u.gridPosition[1]*T]}}),e=ee({box:u,state:e,ai:p}))}return e}({state:e,component:n,event:r})}}})},Pe=function(t){return t.width=.3,t.height=.6,t.color="white",t.cornerRadius=20,t.background="green",t.fontSize=30,t.isPointerBlocker=!0,t},Ee=function(){return(Ee=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},Ie=document.getElementById("game"),Be="humanPlayer",Se=new o.Engine(Ie,!0,{preserveDrawingBuffer:!0,stencil:!0,disableWebGL2Support:!1}),Me=new o.Scene(Se);Se.runRenderLoop((function(){Me&&Me.activeCamera&&Me.render()}));var ke=new o.UniversalCamera("UniversalCamera",new o.Vector3(0,0,-1),Me);ke.mode=o.Camera.ORTHOGRAPHIC_CAMERA;var Le=new o.HemisphericLight("light",new o.Vector3(0,0,1),Me);Le.intensity=1,Le.diffuse=new BABYLON.Color3(1,1,1),Le.specular=new BABYLON.Color3(1,1,1),Le.groundColor=new BABYLON.Color3(1,1,1);var Re=function(){var t=k;t=function(t){return h({state:t,name:a.ai,create:function(t){var e=t.component,n=t.state;return e.textureSet.forEach((function(t){(new Image).src=t})),n}})}(t=ae(t)),t=function(t){return h({state:t,name:a.camera,create:function(t){var e=t.state,n=t.component;return ke.position.x=n.position[1],ke.position.y=n.position[0],ke.position.z=-10,ke.setTarget(new o.Vector3(n.position[1],n.position[0])),O(n.distance,Me),e},update:function(t){var e=t.state,n=t.component;return ke.position.x=n.position[1],ke.position.y=n.position[0],ke.position.z=-10,ke.setTarget(new o.Vector3(n.position[1],n.position[0])),O(n.distance,Me),e}})}(t=function(t){return h({state:t,name:a.marker,create:function(t){var e,n,a=t.state,r=t.component,i=o.Mesh.CreatePlane(me,1.4,Me,!0);return i.uniqueId=parseInt(r.entity),i.position=new o.Vector3(9999,9999,9999),i.material=new o.StandardMaterial("material",Me),i.material.useAlphaFromDiffuseTexture=!0,Ft({mesh:i,color:[1,1,1],texture:fe,scene:Me}),i.material.diffuseTexture.hasAlpha=!0,i.animations[0]=(e=new o.Animation("getScaleAnimation","scaling",1,o.Animation.ANIMATIONTYPE_VECTOR3,o.Animation.ANIMATIONLOOPMODE_RELATIVE),(n=[]).push({frame:0,value:new o.Vector3(2,2,1)}),n.push({frame:.5,value:new o.Vector3(.9,.9,1)}),e.setKeys(n),e),i.animations[1]=function(){var t=new o.Animation("getAlphaAnimation","material.alpha",1,o.Animation.ANIMATIONTYPE_FLOAT,o.Animation.ANIMATIONLOOPMODE_RELATIVE),e=[];return e.push({frame:0,value:1}),e.push({frame:.5,value:0}),t.setKeys(e),t}(),a},update:function(t){var e=t.state,n=t.component,a=Me.getMeshByUniqueId(parseInt(me));return a&&(a.material.diffuseColor=new o.Color3(n.color[0],n.color[1],n.color[2]),Me.beginAnimation(a,0,1,!1),a.position.x=n.position[0],a.position.y=n.position[1],a.position.z=-1),e}})}(t=Te(t)));var e=JSON.parse(localStorage.getItem(re)||"null");return e?t=function(t){var e=t.state;return Object.entries(e.component).reduce((function(t,e){var n=e[0],a=e[1],r=c(n,t.system);return Object.values(a).reduce((function(t,e){return null==r?void 0:r.create({state:t,component:e})}),t)}),e)}({state:t=Ee(Ee({},t),{entity:e.entity,component:e.component})}):(t=s({state:t,data:{entity:Be,name:a.ai,human:!0,level:0,color:[0,0,1],textureSet:["","","","","","",""],active:!0}}),t=s({state:t,data:{currentScene:b.mainMenu,entity:ge,name:a.game,grid:[],round:0,currentPlayer:Be,gameStarted:!1,playersQueue:[],boxRotationQueue:[],quickStart:!0,colorBlindMode:!1,customLevelSettings:{ai:[],levelSize:0},musicEnabled:!1}}),t=s({state:t,data:{entity:w,name:a.camera,position:[0,0],distance:0}}),t=s({state:t,data:{entity:me,name:a.marker,color:[1,1,1],position:[0,0]}}),t=function(t){var e=t.state;return function(t){var e=t.scene,n=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("mainUI",!1,e),a=x(e),r=new BABYLON.GUI.Image("logo",L);r.width=.7,r.height=.42/a,n.addControl(r);var o=Pe(BABYLON.GUI.Button.CreateSimpleButton("continueBtn","Continue"));o.onPointerUpObservable.add((function(){M({type:le.Type.startCustomLevel,entity:ge,payload:{}}),n.dispose()})),n.addControl(o);var i=Pe(BABYLON.GUI.Button.CreateSimpleButton("startBtn","Start"));i.onPointerUpObservable.add((function(){M({type:le.Type.startCustomLevel,entity:ge,payload:{}}),n.dispose()})),n.addControl(i);var c=Pe(BABYLON.GUI.Button.CreateSimpleButton("levelSelectBtn","Select level"));c.onPointerUpObservable.add((function(){M({type:le.Type.startCustomLevel,entity:ge,payload:{}}),n.dispose()})),n.addControl(c);var u=Pe(BABYLON.GUI.Button.CreateSimpleButton("muteBtn","Mute"));u.onPointerUpObservable.add((function(){M({type:le.Type.startCustomLevel,entity:ge,payload:{}}),n.dispose()})),n.addControl(u);var s=new BABYLON.GUI.TextBlock;s.text="by Arek Rado",s.color="white",s.fontSize=24,n.addControl(s);var p=new BABYLON.GUI.Grid;p.background="black",n.addControl(p),p.addColumnDefinition(1),p.addRowDefinition(.3),p.addRowDefinition(.1),p.addRowDefinition(.1),p.addRowDefinition(.1),p.addRowDefinition(.1),p.addRowDefinition(.1),p.addRowDefinition(.1),p.addControl(r,0,0),p.addControl(o,1,0),p.addControl(c,2,0),p.addControl(i,3,0),p.addControl(u,4,0),p.addControl(s,5,0)}({state:e,scene:t.scene}),Oe({state:e,data:{currentScene:b.customLevel}})}({scene:Me,state:t})),t}();Me.registerBeforeRender((function(){Re=function(t){var e=t.state;I="second",S={};var n=e.system.concat().sort((function(t,e){return t>e?-1:1})).reduce((function(t,e){return e.tick({state:t,eventBuffer:B})}),e);return B={},I="first",B=E({},S),n}({state:Re})})),window.addEventListener("resize",(function(){O(P(Z({state:Re})).cameraDistance,Me),Se.resize()}))}},t=>{"use strict";t.O(0,[216],(()=>(368,t(t.s=368)))),t.O()}]);