(self.webpackChunkkostki=self.webpackChunkkostki||[]).push([[179],{99:(t,e,n)=>{"use strict";n.d(e,{nS:()=>Te,$z:()=>we,Ah:()=>Ae});var r,a,o=n(385),i=function(){return(i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},c=function(t,e){return e.find((function(e){return e.name===t}))};(a=r||(r={})).box="box",a.ai="ai",a.game="game";var u,s=function(t){var e,n,r=t.state,a=t.data,o=i(i({},r),{component:i(i({},r.component),(e={},e[a.name]=i(i({},r.component[a.name]),(n={},n[a.entity]=a,n)),e))}),u=c(a.name,r.system);return void 0===u||void 0!==r.component[a.name]&&void 0!==r.component[a.name][a.entity]?o:u.create({state:o,component:a})},d=function(t){var e=t.state,n=t.name,r=f({state:e,name:n});return r?Object.keys(r).reduce((function(t,e){return function(t){var e,n=t.name,r=t.entity,a=t.state,o=a.component[n],u=r,s=(o[u],function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(t);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(t,r[a])&&(n[r[a]]=t[r[a]])}return n}(o,["symbol"==typeof u?u:u+""])),d=i(i({},a),{component:i(i({},a.component),(e={},e[n]=s,e))}),f=p({name:n,state:a,entity:r}),l=c(n,d.system);return l&&f?l.remove({state:d,component:f}):d}({name:n,entity:e,state:t})}),e):e},p=function(t){var e=t.name,n=t.entity,r=t.state.component[e];return r?r[n]:void 0},f=function(t){var e=t.name;return t.state.component[e]},l=function(){return(l=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},y=function(t,e){for(var n=0,r=e.length,a=t.length;n<r;n++,a++)t[a]=e[n];return t};!function(t){t[t.last=3]="last",t[t.time=3]="time",t[t.io=2]="io",t[t.transform=1]="transform",t[t.zero=0]="zero",t[t.sprite=-1]="sprite",t[t.draw=-2]="draw"}(u||(u={}));var v,m=function(t){return t.state},b=function(t){var e=t.state,n=t.tick,r=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(t);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(t,r[a])&&(n[r[a]]=t[r[a]])}return n}(t,["state","tick"]),a={name:r.name,priority:r.priority||u.zero,initialize:r.initialize||m,create:r.create||m,tick:function(t){var e=t.state,a=t.eventBuffer,o=e.component[r.name];return o?Object.values(o).reduce((function(t,e){var o=function(t){var e=t.entity,n=t.eventBuffer,r=t.state,a=t.eventHandler,o=t.component;return n[e]?n[e].reduce((function(t,n){if(a){var r=p({state:t,entity:e,name:o.name});return r?a({state:t,event:n,component:r}):t}return t}),r):r}({eventHandler:r.event,state:t,eventBuffer:a,entity:e.entity,component:e});return n?n({state:o,component:e}):o}),e):e},remove:r.remove||m,event:r.event||m};return l(l({},e),{system:y(y([],e.system),[a])})},g=function(){return(g=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},h="first",x={},O={},w=function(t){"first"===h?(x[t.entity]||(x[t.entity]=[]),x[t.entity].push(t)):(O[t.entity]||(O[t.entity]=[]),O[t.entity].push(t))},E=function(){return(E=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};!function(t){t.Type||(t.Type={})}(v||(v={}));var A,T=function(t,e,n){return t&&t[n]?t[n][e]:void 0},P=0,B=10,I=-10,C=-5,k=-4,M=-15,S=50,R=0,L=1,N=2,j=7,V=-5,U=-4,q=0,G=0;!function(t){t[t.less=-1]="less",t[t.equal=0]="equal",t[t.more=1]="more"}(A||(A={}));var D=function(t){var e=t.state,n=oe({state:e});return n?n.grid.reduce((function(t,n){var a=p({name:r.box,state:e,entity:n});if(a){var o=a.gridPosition[0],i=a.gridPosition[1];t[o]||(t[o]=[]),t[o][i]=E(E({},a),{points:0})}return t}),[]):[]},Q=function(t){var e=t.dataGrid,n=t.currentPlayer;return e.reduce((function(t,r,a){return t[a]=r.reduce((function(t,r,o){if(r.player!==n&&void 0!==r.player)return t;var i=[[T(e,o-1,a-1),T(e,o,a-1),T(e,o+1,a-1)],[T(e,o-1,a),T(e,o,a),T(e,o+1,a)],[T(e,o-1,a+1),T(e,o,a+1),T(e,o+1,a+1)]],c=function(t){var e=t[1][1];return function(t){return[t[1][0],t[0][1],t[1][2],t[2][1]]}(t).reduce((function(t,n){if(!n)return t+R;var r=e.dots===n.dots?A.equal:e.dots>n.dots?A.more:A.less;if(n.player!==e.player&&void 0!==n.player){if(r===A.more){var a=e.dots-n.dots;return t+P-a}if(r===A.equal)return t+B*e.dots;if(r===A.less)return a=n.dots-e.dots,t+I*a}else{if(6===e.dots)return t;if(r===A.more)return t+C;if(r===A.equal)return 6===n.dots&&6===e.dots?t+S:t+k;if(r===A.less)return 6===n.dots?t+2*M:t+M}return t}),0)}(i)+function(t){var e=t[1][1];return function(t){return[t[0][0],t[0][2],t[2][0],t[2][2]]}(t).reduce((function(t,n){if(!n)return t+G;var r=e.dots===n.dots?A.equal:e.dots>n.dots?A.more:A.less;if(n.player!==e.player&&void 0!==n.player){if(r===A.more)return t+L;if(r===A.equal)return 6===n.dots?t+-10*N:t+N;if(r===A.less)return 6===n.dots?t+2*j:t+j}else{if(6===e.dots)return t;if(r===A.more)return t+V;if(r===A.equal)return t+U;if(r===A.less){var a=n.dots-e.dots;return t+q+Math.pow(a,2)}}return t}),0)}(i);return t[o]=E(E({},r),{points:r.points+c}),t}),r),t}),e)},Y=function(t){var e=t.state,n=t.ai,r=t.preferEmptyBoxes,a=n.entity,o=D({state:e});return o=function(t){var e=t.dataGrid,n=t.preferEmptyBoxes;return e.reduce((function(t,e,r){return t[r]=e.reduce((function(t,e,r){var a=void 0===e.player,o=n?100:0,i=a?e.points+50+o:e.points;return t[r]=E(E({},e),{points:i}),t}),e),t}),e)}({dataGrid:o,preferEmptyBoxes:!!r}),function(t){var e=t.currentPlayer,n=-1/0,r=[];t.dataGrid.forEach((function(t){t.forEach((function(t){var a=void 0===t.player,o=t.player===e;(a||o)&&(t.points>n&&(r=[]),t.points>=n&&(n=t.points,r.push(t)))}))}));var a=Math.floor(Math.random()*r.length);return r[a]}({currentPlayer:a,dataGrid:o=Q({currentPlayer:a,dataGrid:o})})};const z=n.p+"57365b6b32a38acad399fa24be970b62.png",_=n.p+"86711768640182ba9774e66c59e43713.png",H=n.p+"d5fd50f6577249e4bd0a6cedc07b855c.png",F=n.p+"1cece826ef3290f02e8ab121defa70e5.png",K=n.p+"04486ea103fd49156ce128e43c00f4af.png",W=n.p+"4c8888485f10730f523694c6ac7449e4.png",$=n.p+"3bb45fa09a5eb9cd805c7f32aab31591.png",J=n.p+"289b33e3a3e1c125f813747944282bbb.png",X=n.p+"e7015b6db11decc2aa7f722b6eaaa343.png",Z=n.p+"7e6aabd8e3d92edca81c0207761816f0.png",tt=n.p+"1a202abfbdfbb945f566e890f0e0fa7f.png",et=n.p+"ad7c3be816ce34c76152ecc6c61d263b.png",nt=n.p+"8711d0d55135c6a04bf3e76aa6287504.png",rt=n.p+"717e6eb5fb82bedfc88f6dc0c65b6f12.png",at=n.p+"16c7f9cc6c2acada16547b3befe94a91.png",ot=n.p+"2d2b2519ce6d9ed0c93cd7ed21aed043.png",it=n.p+"7fa7abdc3e479f97ee5f6b283630df03.png",ct=n.p+"f3941c38549dddc4a8cb586591e36996.png",ut=n.p+"62bd7e3778d77e5ca308fcb5f4b0da78.png",st=n.p+"2f30a46bdc58014e8ba857f895bbe5b8.png",dt=n.p+"de0b87223c2e5708366657b7da01c941.png",pt=n.p+"54b2699e76fca159c5797b2b93b10bd4.png",ft=n.p+"3d713800c02422e02fe02e70f53e9771.png",lt=n.p+"2f9682e3f7d362cc3087ef4dcbbdfd2b.png",yt=n.p+"62f6adca2ae3c6e088aac66bc47cb54e.png",vt=n.p+"9bb2d886948bbd78603ec224904774fd.png",mt=n.p+"2d9f8ec02b7087dc45bf61208aacf7a8.png",bt=n.p+"4fd5888696b352601fd6c1f7a1420e1f.png",gt=n.p+"d62f41f971620bf90529571efed25c8e.png",ht=n.p+"2c7434786497b8ccb02757089a53015a.png",xt=n.p+"51f16b6b18086fcc295f8bc02e6c8c45.png",Ot=n.p+"0dfd6a6b5e5120be13c81ddc1d84a1df.png",wt=n.p+"301a367840edef78b86808852d0c067e.png",Et=n.p+"d854a7c9f810ebe5be07e17990bd0ee4.png",At=n.p+"777079c111d24a4a0402f5afbc95b175.png",Tt=n.p+"e1b39772fd20282e80743b1f04be6795.png",Pt=n.p+"24075b75ce25b7869e6559cccca76b75.png";n.p,n.p,n.p,n.p,n.p,n.p,n.p,n.p,n.p,n.p,n.p,n.p;var Bt,It,Ct=[z,_,H,F,K,W,$],kt=[z,J,X,Z,tt,et,nt],Mt=[z,rt,at,ot,it,ct,ut],St=[z,st,dt,pt,ft,lt,yt],Rt=[z,vt,mt,bt,gt,ht,xt],Lt=[z,Ot,wt,Et,At,Tt,Pt],Nt=function(t){var e=t.mesh,n=t.texture,r=t.scene,a=t.color;e.material.diffuseColor=new o.Color3(a[0],a[1],a[2]);var i=new o.Texture(n,r,void 0,void 0,o.Texture.NEAREST_NEAREST_MIPLINEAR);return e.material.diffuseTexture=i,i},jt=function(){return(jt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},Vt=function(t,e){for(var n=0,r=e.length,a=t.length;n<r;n++,a++)t[a]=e[n];return t};!function(t){t[t.up=0]="up",t[t.down=1]="down",t[t.left=2]="left",t[t.right=3]="right"}(Bt||(Bt={})),function(t){var e;(e=t.Type||(t.Type={}))[e.onClick=0]="onClick",e[e.rotationEnd=1]="rotationEnd",e[e.rotate=2]="rotate"}(It||(It={}));var Ut=function(t){return t>2*Math.PI||t<-2*Math.PI?-2*Math.PI:t},qt=function(t){var e=t.state,n=t.ai,r=oe({state:e});return(null==r?void 0:r.colorBlindMode)?n.textureSet:Ct},Gt=function(t){var e=t.entity,n=t.state,r=oe({state:n});return r?s({state:n,data:jt(jt({},r),{boxRotationQueue:Vt(Vt([],r.boxRotationQueue),[e])})}):n},Dt=function(t){var e=t.entity,n=t.animationEndCallback,r=(t.direction,t.color),a=t.texture,i=Ae.getTransformNodeByUniqueId(parseInt(e));if(i){var c=o.Tools.ToRadians(90)*(Math.random()>.5?1:-1),u=Math.random()>.5?"x":"y",s=i.rotation,d=new o.Vector3("x"===u?c:0,"y"===u?c:0,0).add(s),p=new o.Vector3(Ut(d.x),Ut(d.y),Ut(d.z)),f=new o.Animation("rotateAnimation","rotation",1,o.Animation.ANIMATIONTYPE_VECTOR3,o.Animation.ANIMATIONLOOPMODE_RELATIVE),l=new o.AnimationEvent(.5,n,!0);f.addEvent(l);var y=[];y.push({frame:0,value:s}),y.push({frame:.5,value:p}),f.setKeys(y),i.animations[i.animations.length]=f,Ae.beginAnimation(i,0,1,!1),i.getChildren().slice(0,-1).forEach((function(t){var e=Ae.getMeshByUniqueId(t.uniqueId);e&&Nt({mesh:e,color:r,texture:a,scene:Ae})}))}},Qt=function(t){return 6===t?1:t+1},Yt=function(t){var e=t.state,n=t.ai,r=t.box,a=r.entity,o=r.dots;return n&&(o=Qt(r.dots),Dt({entity:a,animationEndCallback:function(){w({type:It.Type.rotationEnd,entity:a,payload:{ai:n,shouldExplode:6===r.dots}})},texture:qt({state:e,ai:n})[o],color:n.color}),e=Gt({entity:a,state:e})),s({state:e,data:jt(jt({},r),{isAnimating:!0,player:(null==n?void 0:n.entity)||"",dots:o})})},zt=function(t){var e=t.boxEntity,n=t.texture,r=t.color,a=Ae.getTransformNodeByUniqueId(parseInt(e));a&&(a.rotation.x=0,a.rotation.y=0,a.getChildren().forEach((function(t){var e=Ae.getMeshByUniqueId(t.uniqueId);e&&Nt({mesh:e,color:r,texture:n,scene:Ae})})))},_t=function(){return(_t=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},Ht=[.11,.79,.29],Ft=[.09,.84,1],Kt=[1,.73,.29],Wt=[.99,.97,.32],$t=[.99,.42,.45],Jt=[.99,.47,.94];const Xt=n.p+"de1ab0613214552916d369d2014d1d95.png";var Zt,te=function(){return(te=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},ee=function(){return(ee=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},ne="game";!function(t){var e;(e=t.Type||(t.Type={}))[e.startLevel=0]="startLevel",e[e.nextTurn=1]="nextTurn",e[e.boxExplosion=2]="boxExplosion",e[e.playerClick=3]="playerClick"}(Zt||(Zt={}));var re,ae=function(t){var e=t.boxEntity,n=t.markerEntity,r=t.color,a=Ae.getTransformNodeByUniqueId(parseInt(e)),i=Ae.getMeshByUniqueId(parseInt(n));i&&a&&(i.material.alpha=0,i.material.diffuseColor=new o.Color3(r[0],r[1],r[2]),Ae.beginAnimation(i,0,1,!1),i.position=new o.Vector3(a.position.x,a.position.y,a.position.z-1))},oe=function(t){var e=t.state;return p({state:e,entity:ne,name:r.game})},ie=function(t){var e=t.playersQueue,n=t.index,a=t.state,o=p({state:a,name:r.ai,entity:e[n]});return(null==o?void 0:o.active)?o:ie({playersQueue:e,index:n>=e.length?0:n+1,state:a})},ce=function(t){var e=t.state,n=oe({state:e});if(n){var r=n.playersQueue.findIndex((function(t){return n.currentPlayer===t}));return ie({playersQueue:n.playersQueue,index:r+1,state:e})}},ue=function(t){var e,n=t.state,a=Array.from({length:8}).map((function(){return Array.from({length:8}).map((function(){return{player:void 0,dots:0}}))})),i=function(t,e,n,a){return void 0===a&&(a=!1),{entity:t,name:r.ai,human:a,level:1,color:e,textureSet:n,active:!0}};n=function(t){var e=t.state,n=t.ai;e=d({state:e,name:r.ai});var a=oe({state:e});return a&&(e=s({state:e,data:_t(_t({},a),{playersQueue:n.map((function(t){return t.entity}))})})),n.reduce((function(t,e){return s({state:t,data:e})}),e)}({state:n=ve({dataGrid:a,scene:Ae,camera:Te,state:n}),ai:[i(we,Ft,Ct,!0),i("2",$t,kt),i("3",Ht,Mt),i("4",Wt,St),i("5",Kt,Rt),i("6",Jt,Lt)]}),n=function(t){var e,n,r=t.scene,a=t.state,i=o.Mesh.CreatePlane("marker",le+fe+le,r,!0);i.position=new o.Vector3(9999,9999,9999),i.material=new o.StandardMaterial("material",r),i.material.useAlphaFromDiffuseTexture=!0,Nt({mesh:i,color:[1,1,1],texture:Xt,scene:r}),i.material.diffuseTexture.hasAlpha=!0,i.animations[0]=(e=new o.Animation("getScaleAnimation","scaling",1,o.Animation.ANIMATIONTYPE_VECTOR3,o.Animation.ANIMATIONLOOPMODE_RELATIVE),(n=[]).push({frame:0,value:new o.Vector3(2,2,1)}),n.push({frame:.5,value:new o.Vector3(.9,.9,1)}),e.setKeys(n),e),i.animations[1]=function(){var t=new o.Animation("getAlphaAnimation","material.alpha",1,o.Animation.ANIMATIONTYPE_FLOAT,o.Animation.ANIMATIONLOOPMODE_RELATIVE),e=[];return e.push({frame:0,value:1}),e.push({frame:.5,value:0}),t.setKeys(e),t}();var c=oe({state:a});return c?s({state:a,data:te(te({},c),{markerEntity:i.uniqueId.toString()})}):a}({scene:Ae,state:n});var c=oe({state:n}),u=p({name:r.ai,state:n,entity:(null==c?void 0:c.currentPlayer)||""});if(!u||!c)return n;if(console.log(null===(e=oe({state:n}))||void 0===e?void 0:e.grid),n=s({state:n,data:ee(ee({},c),{gameStarted:!0,currentPlayer:u.entity})}),c.quickStart&&function(t){var e=t.state,n=oe({state:e});n&&n.grid.forEach((function(t){var n=p({state:e,entity:t,name:r.box}),a=p({state:e,entity:(null==n?void 0:n.player)||"",name:r.ai});n&&a&&w({type:It.Type.rotate,entity:t,payload:{color:a.color,texture:qt({state:e,ai:a})[n.dots],direction:Bt.up}})}))}({state:n=function(t){var e,n=t.state;return(null===(e=oe({state:n}))||void 0===e?void 0:e.grid.reduce((function(t){var e=oe({state:t}),n=p({state:t,name:r.ai,entity:(null==e?void 0:e.currentPlayer)||""});if(!e||!n)return t;var a=Y({state:t,ai:n,preferEmptyBoxes:!0});if(!a)return t;t=s({state:t,data:ee(ee({},a),{player:n.entity,dots:Qt(a.dots)})});var o=ce({state:t});return o?t=s({state:t,data:ee(ee({},e),{currentPlayer:o.entity})}):t}),n))||n}({state:n})}),n=s({state:n,data:ee(ee({},c),{gameStarted:!0,currentPlayer:u.entity})}),!u.human){var f=Y({state:n,ai:u});f&&(n=Yt({box:f,state:n,ai:u}))}return n},se=function(t){var e=t.getEngine().getRenderingCanvasClientRect();return null!==e?e.height/e.width:1},de=function(t,e){var n=se(e),r=e.activeCamera;r&&(n>1?(r.orthoLeft=-t,r.orthoRight=t,r.orthoBottom=r.orthoLeft*n,r.orthoTop=r.orthoRight*n):(r.orthoBottom=-t,r.orthoTop=t,r.orthoLeft=r.orthoBottom/n,r.orthoRight=r.orthoTop/n))},pe=function(){return(pe=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},fe=1,le=.2,ye=function(t){var e=fe+le,n=t[0].length*e,r=t.length*e;return{center:[(n-1-le)/2,(r-1-le)/2],cameraDistance:(n>r?n:r)/2+le}},ve=function(t){var e=t.dataGrid,n=t.scene,a=t.camera,i=t.state,c=new o.TransformNode("grid"),u=ye(e),d=u.center,p=u.cameraDistance;a.position.x=d[1],a.position.y=d[0],a.position.z=-10,a.setTarget(new o.Vector3(d[1],d[0])),de(p,n);var f=[],l=fe+le;i=e.reduce((function(t,e,a){return e.reduce((function(t,e,i){var u=e.dots,d=e.player,p=function(t){var e=t.scene,n=t.name,r=new o.TransformNode("box "+n,e);return[[new o.Vector3(-.5,0,0),new o.Vector3(0,Math.PI/2,0)],[new o.Vector3(0,0,.5),new o.Vector3(0,Math.PI,0)],[new o.Vector3(.5,0,0),new o.Vector3(0,-Math.PI/2,0)],[new o.Vector3(0,.5,0),new o.Vector3(Math.PI/2,0,0)],[new o.Vector3(0,-.5,0),new o.Vector3(-Math.PI/2,0,0)],[new o.Vector3(0,0,-.5),new o.Vector3(0,0,0)]].forEach((function(t,n){var a=t[0],i=t[1],c=o.Mesh.CreatePlane("plane"+n,1,e,!0);c.parent=r,c.material=new o.StandardMaterial("mat",e),Nt({mesh:c,color:[1,1,1],texture:z,scene:e}),c.material.alpha=1,c.position=a,c.rotation=i,c.setParent(r),c.actionManager=new o.ActionManager(e),c.actionManager.registerAction(new o.ExecuteCodeAction(o.ActionManager.OnPickUpTrigger,(function(){w({entity:ne,type:Zt.Type.playerClick,payload:{boxEntity:r.uniqueId.toString()}})})))})),r}({scene:n,name:a+"-"+i});p.position.x=a*l,p.position.y=i*l,p.setParent(c);var y=p.uniqueId.toString();return f.push(y),s({state:t,data:{name:r.box,entity:y,isAnimating:!1,dots:u,gridPosition:[a,i],player:d}})}),t)}),i);var y=oe({state:i});return y?i=s({state:i,data:pe(pe({},y),{grid:f})}):i},me={entity:{},component:(re={},re[r.box]={},re[r.ai]={},re[r.game]={},re),system:[]},be=me=function(t){return b({state:t,name:r.game,event:function(t){var e=t.state,n=t.component,a=t.event;switch(a.type){case Zt.Type.startLevel:return ue({state:e,component:n,event:a});case Zt.Type.nextTurn:return function(t){var e=t.state,n=t.component,a=n.gameStarted,o=n.boxRotationQueue;if(a&&0===o.length){var i=ce({state:e});if(!i)return e;var c=p({name:r.ai,state:e,entity:i.entity});if(!c)return e;if(e=s({state:e,data:ee(ee({},n),{currentPlayer:c.entity})}),!c.human&&c.active){var u=Y({state:e,ai:c});if(!u)return function(t){var e=t.state,n=t.ai,a=t.component;e=s({state:e,data:ee(ee({},n),{active:!1})});var o=f({state:e,name:r.ai});return 1===Object.values(o||{}).reduce((function(t,e){return e.active?t+1:t}),0)?s({state:e,data:ee(ee({},a),{gameStarted:!1})}):(w({type:Zt.Type.nextTurn,entity:ne,payload:{ai:n}}),e)}({state:e,component:n,ai:c});ae({boxEntity:u.entity,color:c.color,markerEntity:n.markerEntity}),e=Yt({box:u,state:e,ai:c}),e=Gt({state:e,entity:u.entity})}}return e}({state:e,component:n,event:a});case Zt.Type.playerClick:return function(t){var e=t.state,n=t.component,a=t.event,o=n.currentPlayer,i=n.gameStarted,c=n.boxRotationQueue,u=p({state:e,name:r.box,entity:a.payload.boxEntity}),s=void 0===(null==u?void 0:u.player)||(null==u?void 0:u.player)===o;if(i&&0===c.length&&s){var d=p({name:r.ai,state:e,entity:o});u&&(null==d?void 0:d.human)&&(ae({boxEntity:u.entity,color:d.color,markerEntity:n.markerEntity}),e=Yt({box:u,state:e,ai:d}))}return e}({state:e,component:n,event:a})}}})}(me=function(t){return b({state:t,name:r.ai,create:function(t){var e=t.component,n=t.state;return e.textureSet.forEach((function(t){(new Image).src=t})),n}})}(me=function(t){return b({state:t,name:r.box,create:function(t){return t.state},event:function(t){var e=t.state,n=t.component,r=t.event;switch(r.type){case It.Type.rotationEnd:return function(t){var e=t.state,n=t.component,r=t.event.payload,a=r.ai,o=r.shouldExplode;e=function(t){var e=t.entity,n=t.state,r=oe({state:n});return r?s({state:n,data:jt(jt({},r),{boxRotationQueue:r.boxRotationQueue.filter((function(t){return t!==e}))})}):n}({entity:n.entity,state:e}),zt({boxEntity:n.entity,texture:qt({state:e,ai:a})[n.dots],color:a.color});var i=oe({state:e});if(!i)return e;o?e=function(t){var e=t.state,n=t.ai,r=t.box.gridPosition,a=r[0],o=r[1],i=D({state:e});return[T(i,o,a-1),T(i,o,a+1),T(i,o-1,a),T(i,o+1,a)].filter((function(t){return void 0!==t})).reduce((function(t,e,r){return t=Yt({ai:n,box:e,state:t}),Gt({entity:e.entity,state:t})}),e)}({state:e,box:n,ai:a}):0===i.boxRotationQueue.length&&w({type:Zt.Type.nextTurn,entity:ne,payload:{ai:a}});var c=Ae.getTransformNodeByUniqueId(parseInt(n.entity));return c&&(c.animations=[]),s({state:e,data:jt(jt({},n),{isAnimating:!1})})}({state:e,component:n,event:r});case It.Type.rotate:return function(t){var e=t.state,n=t.component,r=t.event;return Dt({entity:n.entity,animationEndCallback:function(){zt({boxEntity:n.entity,texture:r.payload.texture,color:r.payload.color})},texture:r.payload.texture,color:r.payload.color}),e}({state:e,component:n,event:r})}}})}(me))),ge=function(){return(ge=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};n(290);const he=n.p+"8b1469fe19d1d6c3811ef4ef5c6df926.png";var xe=function(t){return t.width=.3,t.height=.6,t.color="white",t.cornerRadius=20,t.background="green",t.fontSize=30,t.isPointerBlocker=!0,t},Oe=document.getElementById("game"),we="humanPlayer",Ee=new o.Engine(Oe,!0,{preserveDrawingBuffer:!0,stencil:!0,disableWebGL2Support:!1}),Ae=new o.Scene(Ee);Ee.runRenderLoop((function(){Ae&&Ae.activeCamera&&Ae.render()}));var Te=new o.UniversalCamera("UniversalCamera",new o.Vector3(0,0,-1),Ae);Te.mode=o.Camera.ORTHOGRAPHIC_CAMERA;var Pe=new o.HemisphericLight("light",new o.Vector3(0,0,1),Ae);Pe.intensity=1,Pe.diffuse=new BABYLON.Color3(1,1,1),Pe.specular=new BABYLON.Color3(1,1,1),Pe.groundColor=new BABYLON.Color3(1,1,1);var Be=function(t){void 0===t&&(t={game:{}});var e=s({state:be,data:{entity:we,name:r.ai,human:!0,level:0,color:[0,0,1],textureSet:["","","","","","",""],active:!0}});return s({state:e,data:ge({entity:ne,name:r.game,grid:[],round:0,currentPlayer:we,gameStarted:!1,playersQueue:[],boxRotationQueue:[],quickStart:!1,colorBlindMode:!1,markerEntity:""},null==t?void 0:t.game)})}({game:{quickStart:!0}});!function(t){var e=t.scene,n=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("mainUI",!1,e),r=se(e),a=new BABYLON.GUI.Image("logo",he);a.width=.7,a.height=.42/r,n.addControl(a);var o=xe(BABYLON.GUI.Button.CreateSimpleButton("continueBtn","Continue"));o.onPointerUpObservable.add((function(){w({type:Zt.Type.startLevel,entity:ne,payload:{}}),n.dispose()})),n.addControl(o);var i=xe(BABYLON.GUI.Button.CreateSimpleButton("startBtn","Start"));i.onPointerUpObservable.add((function(){w({type:Zt.Type.startLevel,entity:ne,payload:{}}),n.dispose()})),n.addControl(i);var c=xe(BABYLON.GUI.Button.CreateSimpleButton("levelSelectBtn","Select level"));c.onPointerUpObservable.add((function(){w({type:Zt.Type.startLevel,entity:ne,payload:{}}),n.dispose()})),n.addControl(c);var u=xe(BABYLON.GUI.Button.CreateSimpleButton("muteBtn","Mute"));u.onPointerUpObservable.add((function(){w({type:Zt.Type.startLevel,entity:ne,payload:{}}),n.dispose()})),n.addControl(u);var s=new BABYLON.GUI.TextBlock;s.text="by Arek Rado",s.color="white",s.fontSize=24,n.addControl(s);var d=new BABYLON.GUI.Grid;d.background="black",n.addControl(d),d.addColumnDefinition(1),d.addRowDefinition(.3),d.addRowDefinition(.1),d.addRowDefinition(.1),d.addRowDefinition(.1),d.addRowDefinition(.1),d.addRowDefinition(.1),d.addRowDefinition(.1),d.addControl(a,0,0),d.addControl(o,1,0),d.addControl(c,2,0),d.addControl(i,3,0),d.addControl(u,4,0),d.addControl(s,5,0)}({scene:Ae}),Ae.registerBeforeRender((function(){Be=function(t){var e=t.state;h="second",O={};var n=e.system.concat().sort((function(t,e){return t>e?-1:1})).reduce((function(t,e){return e.tick({state:t,eventBuffer:x})}),e);return x={},h="first",x=g({},O),n}({state:Be})})),window.addEventListener("resize",(function(){de(ye(D({state:Be})).cameraDistance,Ae),Ee.resize()}))}},t=>{"use strict";t.O(0,[216],(()=>(99,t(t.s=99)))),t.O()}]);