"use strict";(self.webpackChunkkostki=self.webpackChunkkostki||[]).push([[179],{7268:(e,t,n)=>{n.d(t,{$:()=>ea});var a=n(1361);let o,r,i,s,l;var c;(c=o||(o={})).box="box",c.ai="ai",c.game="game",c.marker="marker",c.background="background",c.logo="logo",function(e){e.mainMenu="mainMenu",e.customLevel="customLevel",e.customLevelSettings="customLevelSettings"}(r||(r={})),function(e){e.mainMenu="mainMenu",e.customLevel="customLevel",e.customLevelSettings="customLevelSettings"}(i||(i={})),function(e){e.disabled="disabled",e.random="random",e.easy="easy",e.medium="medium",e.hard="hard"}(s||(s={})),function(e){e[e.less=-1]="less",e[e.equal=0]="equal",e[e.more=1]="more"}(l||(l={}));var d=n(7455),u=n(9322),p=n(9228),m=n(5431),y=n(4357);const g={},f=({textureUrl:e,scene:t})=>{const n=new y.x(e,t,void 0,void 0,y.x.NEAREST_NEAREST_MIPLINEAR);return g[e]=n,n},h=n.p+"57365b6b32a38acad399fa24be970b62.png",v=n.p+"86711768640182ba9774e66c59e43713.png",b=n.p+"d5fd50f6577249e4bd0a6cedc07b855c.png",w=n.p+"1cece826ef3290f02e8ab121defa70e5.png",x=n.p+"04486ea103fd49156ce128e43c00f4af.png",C=n.p+"4c8888485f10730f523694c6ac7449e4.png",T=n.p+"3bb45fa09a5eb9cd805c7f32aab31591.png",E=n.p+"289b33e3a3e1c125f813747944282bbb.png",S=n.p+"e7015b6db11decc2aa7f722b6eaaa343.png",L=n.p+"7e6aabd8e3d92edca81c0207761816f0.png",P=n.p+"1a202abfbdfbb945f566e890f0e0fa7f.png",M=n.p+"ad7c3be816ce34c76152ecc6c61d263b.png",k=n.p+"8711d0d55135c6a04bf3e76aa6287504.png",R=n.p+"717e6eb5fb82bedfc88f6dc0c65b6f12.png",I=n.p+"16c7f9cc6c2acada16547b3befe94a91.png",B=n.p+"2d2b2519ce6d9ed0c93cd7ed21aed043.png",j=n.p+"7fa7abdc3e479f97ee5f6b283630df03.png",q=n.p+"f3941c38549dddc4a8cb586591e36996.png",G=n.p+"62bd7e3778d77e5ca308fcb5f4b0da78.png",U=n.p+"2f30a46bdc58014e8ba857f895bbe5b8.png",A=n.p+"de0b87223c2e5708366657b7da01c941.png",O=n.p+"54b2699e76fca159c5797b2b93b10bd4.png",F=n.p+"3d713800c02422e02fe02e70f53e9771.png",W=n.p+"2f9682e3f7d362cc3087ef4dcbbdfd2b.png",K=n.p+"62f6adca2ae3c6e088aac66bc47cb54e.png",Q=n.p+"9bb2d886948bbd78603ec224904774fd.png",z=n.p+"2d9f8ec02b7087dc45bf61208aacf7a8.png",D=n.p+"4fd5888696b352601fd6c1f7a1420e1f.png",N=n.p+"d62f41f971620bf90529571efed25c8e.png",V=n.p+"2c7434786497b8ccb02757089a53015a.png",X=n.p+"51f16b6b18086fcc295f8bc02e6c8c45.png",H=n.p+"0dfd6a6b5e5120be13c81ddc1d84a1df.png",$=n.p+"301a367840edef78b86808852d0c067e.png",_=n.p+"d854a7c9f810ebe5be07e17990bd0ee4.png",Y=n.p+"777079c111d24a4a0402f5afbc95b175.png",Z=n.p+"e1b39772fd20282e80743b1f04be6795.png",J=n.p+"24075b75ce25b7869e6559cccca76b75.png",ee=n.p+"698b6e6ce4fcc13dd8ac2cdb9bb484fe.png",te=n.p+"38ca2b18556222743ee8778742514d73.png",ne=n.p+"aebe569c1bf5190e0038b7098791359c.png",ae=n.p+"d1390ce752b5ee52126d21de796a81f8.png",oe=n.p+"d54421100963619575d7b3f35876fdfe.png",re=n.p+"cde379b0a92320968a3826f29eff20fc.png",ie=n.p+"d1b88dc4aa017270afbb48ce8c2d93ee.png",se=n.p+"f07f0db4072406727dc668f8f643b725.png",le=n.p+"f60fcf550b1112ec6a6bb8c80cc4b142.png",ce=n.p+"5fded717b6adc588c2dcdedd900f3bea.png",de=n.p+"ed032e786ebb26ea79c773fd85684876.png",ue=n.p+"7960efbc05f46d226a4e232b391a79ea.png",pe=[h,v,b,w,x,C,T],me=[h,E,S,L,P,M,k],ye=[h,R,I,B,j,q,G],ge=[h,U,A,O,F,W,K],fe=[h,Q,z,D,N,V,X],he=[h,H,$,_,Y,Z,J],ve=[h,ee,te,ne,ae,oe,re],be=[h,ie,se,le,ce,de,ue],we=({state:e})=>{const t=e.babylonjs.sceneRef;return t?((e=>{setTimeout((()=>{pe.forEach((t=>{const n=new Image;n.src=t,n.onload=()=>{f({textureUrl:t,scene:e})}}))}),2e3*Math.random()+1e3)})(t),e):e},xe="game";let Ce;!function(e){let t;!function(e){e.startCustomLevel="GameEvent-startCustomLevel",e.boxExplosion="GameEvent-boxExplosion",e.playerClick="GameEvent-playerClick",e.cleanScene="GameEvent-cleanScene",e.shakeAiBoxes="GameEvent-shakeAiBoxes",e.playAgainCustomLevel="GameEvent-playAgainCustomLevel",e.changePlayers="GameEvent-changePlayers",e.changeDifficulty="GameEvent-changeDifficulty",e.changeQuickStart="GameEvent-changeQuickStart",e.changeColorBlindMode="GameEvent-changeColorBlindMode",e.changeMapType="GameEvent-changeMapType",e.showNewVersion="GameEvent-showNewVersion",e.reload="GameEvent-reload"}(t||(t={})),e.Type=t}(Ce||(Ce={}));const Te=(0,m.o)({entity:xe,name:o.game}),Ee=Te.getComponent,Se=Te.setComponent;var Le=n(2922);const Pe=({mesh:e,texture:t,scene:n,color:a})=>{a&&(e.material.diffuseColor=new Le.Wo(a[0],a[1],a[2]));const o=(({textureUrl:e,scene:t})=>g[e]?g[e]:f({textureUrl:e,scene:t}))({textureUrl:t,scene:n});return e.material.diffuseTexture=o,o},Me=({state:e,ai:t})=>{const n=Ee({state:e});return t&&null!=n&&n.colorBlindMode?t.textureSet:pe};var ke=n(4179),Re=n(5412),Ie=n(5367),Be=n(8084),je=n(8125),qe=n(9798),Ge=n(3052);const Ue=({state:e})=>{const t=Ee({state:e});return t?t.grid.reduce(((t,n)=>{const a=(0,d.X)({name:o.box,state:e,entity:n});if(a){const e=a.gridPosition[0],n=a.gridPosition[1];t[e]||(t[e]=[]),t[e][n]={...a,points:0}}return t}),[]):[]};var Ae=n(2817);const Oe=({value:e,min:t,max:n})=>e<=t?t:e>=n?n:e,Fe=(e,t,n)=>(n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e),We=[1,1,1],Ke=[.6,.6,.6],Qe=[.11,.79,.29],ze=[.09,.84,1],De=[1,.73,.29],Ne=[.99,.97,.32],Ve=[.99,.42,.45],Xe=[.99,.47,.94],He=[.67,.23,.94],$e=(e,t)=>e+Math.random()*t-Math.random()*t,_e=e=>{const t=(([e,t,n])=>{var a,o,r=Math.max(e,t,n),i=Math.min(e,t,n),s=(r+i)/2;if(r==i)a=o=0;else{var l=r-i;switch(o=s>.5?l/(2-r-i):l/(r+i),r){case e:a=(t-n)/l+(t<n?6:0);break;case t:a=(n-e)/l+2;break;case n:a=(e-t)/l+4}a/=6}return[a,o,s]})(e),n=[t[0],Oe({value:$e(t[1],.2),min:.3,max:1}),Oe({value:$e(t[2],.2),min:.3,max:.7})];return(([e,t,n])=>{var a,o,r;if(0==t)a=o=r=n;else{var i=n<.5?n*(1+t):n+t-n*t,s=2*n-i;a=Fe(s,i,e+1/3),o=Fe(s,i,e),r=Fe(s,i,e-1/3)}return[a,o,r]})([n[0],n[1],n[2]])},Ye=e=>[_e(e),_e(e),_e(e),_e(e),_e(e),_e(e),_e(e),_e(e),_e(e),_e(e)],Ze=(Ye(Ke),Ye(Qe),Ye(ze));Ye(De),Ye(Ne),Ye(Ve),Ye(Xe),Ye(He);var Je=n(4442),et=n(7112);const tt=(e,t)=>{document.dispatchEvent(new CustomEvent(e,{detail:t}))},nt="localDbKey",at=e=>{const t=Ee({state:e});t&&ot({players:t.customLevelSettings.players,difficulty:t.customLevelSettings.difficulty,quickStart:t.customLevelSettings.quickStart,mapType:t.customLevelSettings.mapType,colorBlindMode:t.colorBlindMode})},ot=e=>{localStorage.setItem(nt,JSON.stringify(e))},rt=(e,t,n,a=!1,r=s.easy)=>({entity:e,name:o.ai,human:a,level:r,color:t,textureSet:n,active:!0}),it=()=>[rt(ea,ze,pe,!0,s.easy),rt("2",Ve,me,!1,s.easy),rt("3",Qe,ye,!1,s.easy),rt("4",Ne,ge,!1,s.easy),rt("5",De,fe,!1,s.easy),rt("6",Xe,he,!1,s.easy),rt("7",Ke,ve,!1,s.easy),rt("8",He,be,!1,s.easy)],st=(e,t)=>{const n=(e=>{const t=e.getEngine().getRenderingCanvasClientRect();return null!==t?t.height/t.width:1})(t);return n>1?{left:-e,right:e,bottom:-e*n,top:e*n}:{bottom:-e,top:e,left:-e/n,right:e/n}},lt=e=>{if(e.babylonjs.sceneRef){const t=e.babylonjs.sceneRef.getMeshByUniqueId(parseFloat(dt)),n=(0,Ae.bp)({state:e});if(t&&n&&e.babylonjs.sceneRef){const a=st(n.distance,e.babylonjs.sceneRef);t.position.x=n.position[0],t.position.y=n.position[1],t.scaling=new Re.P(Math.abs(a.left)+Math.abs(a.right),Math.abs(a.bottom)+Math.abs(a.top),1)}}return e},ct=({state:e,component:t})=>{if(!e.babylonjs.sceneRef)return e;Je.Q.ShadersStore.customVertexShader=" \n    precision highp float;\n    precision highp int;\n\n    // Attributes\n    attribute vec3 position;\n    attribute vec2 uv;\n\n    // Uniforms\n    uniform mat4 worldViewProjection;\n\n    // Varying\n    varying vec2 vUV;\n\n    void main(void) {\n        gl_Position = worldViewProjection * vec4(position, 1);\n        vUV = uv;\n    }\n  ",Je.Q.ShadersStore.customFragmentShader="\n    precision highp float;\n    precision highp int;\n\n    uniform highp float iTime;\n    uniform vec2 iResolution;\n    uniform highp float[30] iColors;\n\n    // const vec2 iResolution = vec2(512, 512);\n    \n    struct RadialGradient {\n        float radius;\n        vec4 color;\n        vec2 point;\n    };\n  \n    void main(void) {\n        float w = iResolution.x / 2.;\n        float h = iResolution.y / 2.;\n  \n        float fill = max(iResolution.x, iResolution.y);\n        // float contain = min(iResolution.x, iResolution.y);\n\n        highp vec4 colors[10];\n        colors[0] = vec4(iColors[0],iColors[1],iColors[2], 0.7);\n        colors[1] = vec4(iColors[3],iColors[4],iColors[5], 0.7);\n        colors[2] = vec4(iColors[6],iColors[7],iColors[8], 0.7);\n        colors[3] = vec4(iColors[9],iColors[10],iColors[11], 0.7);\n        colors[4] = vec4(iColors[12],iColors[13],iColors[14], 0.7);\n        colors[5] = vec4(iColors[15],iColors[16],iColors[17], 0.7);\n        colors[6] = vec4(iColors[18],iColors[19],iColors[20], 0.7);\n        colors[7] = vec4(iColors[21],iColors[22],iColors[23], 0.7);\n        colors[8] = vec4(iColors[24],iColors[25],iColors[26], 0.7);\n        colors[9] = vec4(iColors[27],iColors[28],iColors[29], 0.7);\n        \n  \n        // gradients\n        RadialGradient gradients[] = RadialGradient[](\n            RadialGradient(1.0, colors[0], vec2(0.5 * w * sin(.13 * iTime - 0.44) + w, 0.5 * h * sin(.34 * iTime - 2.41) + h)),\n            RadialGradient(1.0, colors[1], vec2(0.5 * w * sin(.93 * iTime - 5.58) + w, 1.0 * h * sin(.82 * iTime - 3.04) + h)),\n            RadialGradient(1.0, colors[2], vec2(1.0 * w * sin(.45 * iTime - 2.70) + w, 0.5 * h * sin(.94 * iTime - 5.24) + h)),\n            RadialGradient(1.0, colors[3], vec2(1.0 * w * sin(.15 * iTime - 3.59) + w, 1.0 * h * sin(.96 * iTime - 5.11) + h)),\n            RadialGradient(1.0, colors[4], vec2(0.5 * w * sin(.35 * iTime - 4.73) + w, 0.5 * h * sin(.42 * iTime - 3.87) + h)),\n            RadialGradient(1.0, colors[5], vec2(0.5 * w * sin(.62 * iTime - 4.81) + w, 1.0 * h * sin(.19 * iTime - 1.17) + h)),\n            RadialGradient(1.0, colors[6], vec2(1.0 * w * sin(.58 * iTime - 5.13) + w, 0.5 * h * sin(.10 * iTime - 2.08) + h)),\n            RadialGradient(0.5, colors[7], vec2(1.5 * w * sin(.12 * iTime - 4.36) + w * 2., 0.5 * h * sin(.08 * iTime - 1.48) + h * 2.)),\n            RadialGradient(0.6, colors[8], vec2(1.5 * w * sin(.07 * iTime - 3.94) + w * 2., 0.6 * h * sin(.03 * iTime - 2.03) + h * 2.)),\n            RadialGradient(0.5, colors[9], vec2(1.5 * w * sin(.01 * iTime - 3.74) + w * 2., 0.5 * h * sin(.12 * iTime - 0.62) + h * 2.))\n        );\n  \n        vec3 color = vec3(0.);\n  \n        for(int i = 0; i < gradients.length(); ++i) {\n            color = mix(\n                gradients[i].color.rgb,\n                color,\n                gradients[i].color.a * distance(gradients[i].point, gl_FragCoord.xy) / ( fill * gradients[i].radius)\n            );\n        }\n  \n        gl_FragColor = vec4(color,1.0);\n    }\n  ";const n=new et.j("shader",e.babylonjs.sceneRef,{vertex:"custom",fragment:"custom"},{attributes:["position","normal","uv"],uniforms:["worldViewProjection","time","resolution","gridSize","colors","gridColors"]});n.setFloat("time",performance.now()),n.setVector3("resolution",new Re.P(window.innerWidth,window.innerHeight,0)),n.backFaceCulling=!1;const a=Be.V.CreatePlane(dt,{size:1},e.babylonjs.sceneRef);a.uniqueId=parseFloat(dt),a.material=n;const o=it();return a.material.setColor3Array("colors",o.map((({color:[e,t,n]})=>new Le.Wo(e,t,n)))),lt(e)},dt="17818552155683748",ut=(0,m.o)({entity:dt,name:o.background});ut.getComponent;var pt=n(1238);const mt=({percentage:e,total:t})=>t*e,yt=()=>Math.floor(1e17*Math.random()),gt=[[1,0,0,1,0,0,1,1,0,0,0,1,1,0,1,1,1,0,1,0,0,1,0,1],[1,0,1,0,0,1,0,0,1,0,1,0,0,0,0,1,0,0,1,0,1,0,0,1],[1,1,0,0,0,1,0,0,1,0,1,1,1,0,0,1,0,0,1,1,0,0,0,1],[1,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,1,0,0,1],[1,0,0,1,0,0,1,1,0,0,1,1,0,0,0,1,0,0,1,0,0,1,0,1]].reduce(((e,t,n)=>(e[n]=t.reduce(((e,t,n)=>{if(0===t)e[n]="";else{const t=yt().toString();e[n]=t}return e}),[]),e)),[]);var ft=n(7998);const ht=({state:e})=>e.babylonjs.sceneRef?(e=gt.reduce(((e,t,n)=>t.reduce(((e,t,a)=>""===t?e:(e=(0,ft.L)({state:e,entity:t}),(0,u.L)({state:e,data:{name:o.box,entity:t,isAnimating:!1,dots:0,gridPosition:[a,n],player:""}}))),e)),e),e=Et({state:e,data:{}}),(0,Ge.Kn)({type:xt.Type.rotateRandomLogoBox,payload:{}}),e):e;var vt=n(2996);const bt=({state:e})=>{const t=e.babylonjs.sceneRef;return t?e=gt.flat().reduce(((e,n)=>{const a=t.getTransformNodeByUniqueId(parseFloat(n));return null==a||a.dispose(),(0,vt.S)({state:e,entity:n})}),e):e},wt="8523773494048061";let xt;!function(e){let t;!function(e){e.rotateRandomLogoBox="LogoEvent-rotateRandomLogoBox"}(t||(t={})),e.Type=t}(xt||(xt={}));const Ct=(0,m.o)({entity:wt,name:o.logo}),Tt=Ct.getComponent,Et=({state:e,data:t})=>{const n=(0,Ae.bp)({state:e});return(({state:e,data:t})=>(lt(e),ut.setComponent({state:e,data:t})))({state:e=(({state:e,data:t})=>(e=(({state:e})=>{if(!e.babylonjs.sceneRef)return e;const t=(0,Ae.bp)({state:e});if(!t)return e;const{topEdge:n,boxSize:a,screenSize:o}=(({state:e,boxScaleFactor:t})=>{const n=(0,Ae.bp)({state:e});return n?{leftEdge:n.position[0]+n.left,topEdge:n.position[1]+n.top,boxSize:St/t,screenSize:[2*n.right,2*n.top]}:{leftEdge:0,topEdge:0,boxSize:0,screenSize:[0,0]}})({state:e,boxScaleFactor:3.2}),r=[gt[0].length*a,gt.length*a],i=[t.position[0]-r[0]/2,n-mt({total:o[1],percentage:.1})];return gt.reduce(((e,t,n)=>t.reduce(((e,t,o)=>{if(""===t)return e;const r=[i[0]+o*a,i[1]+-n*a],s=(0,d.X)({state:e,name:p.f.transform,entity:t});return s?(0,pt.w)({state:e,data:{...s,position:[r[0],r[1]],scale:[.3125,.3125,.3125]}}):e}),e)),e)})({state:e}),Ct.setComponent({state:e,data:t})))({state:e=(0,Ae.GR)({state:e,data:{...n,...t}}),data:{}}),data:{}})},St=1.2,Lt=({state:e,component:t})=>{const n=e.babylonjs.sceneRef;if(!n)return e;const{gridPosition:a}=t,r=(0,d.X)({state:e,name:o.ai,entity:t.player||""});return e=(0,u.L)({state:e,data:{name:p.f.transform,entity:t.entity,rotation:[0,0,0],fromParentRotation:[0,0,0],scale:[1,1,1],fromParentScale:[1,1,1],position:[a[0]*St,a[1]*St],fromParentPosition:[0,0]}}),(({scene:e,name:t,uniqueId:n,position:a,color:o,state:r,ai:i,dots:s,isClickable:l,scaleFactor:c=1})=>{const d=1/c,u=new ke.Y(`box ${t}`,e);u.uniqueId=n,[[new Re.P(0,0,-d/2),new Re.P(0,0,0)],[new Re.P(-d/2,0,0),new Re.P(0,Math.PI/2,0)],[new Re.P(0,0,d/2),new Re.P(0,Math.PI,0)],[new Re.P(d/2,0,0),new Re.P(0,-Math.PI/2,0)],[new Re.P(0,d/2,0),new Re.P(Math.PI/2,0,0)],[new Re.P(0,-d/2,0),new Re.P(-Math.PI/2,0,0)]].forEach((([t,a],c)=>{const p=Be.V.CreatePlane("plane"+c,{size:d});p.parent=u,p.material=new Ie.K("mat",e),Pe({mesh:p,color:o,texture:Me({state:r,ai:i})[s],scene:e}),p.material.alpha=1,p.position=t,p.rotation=a,l&&(p.actionManager=new je.k(e),p.actionManager.registerAction(new qe.fQ(je.k.OnPickUpTrigger,(()=>{(0,Ge.Kn)({type:Ce.Type.playerClick,payload:{boxEntity:n.toString()}})}))))}))})({scene:n,name:`${a[0]}-${a[1]}`,position:[a[0]*St,a[1]*St],uniqueId:parseFloat(t.entity),color:(null==r?void 0:r.color)||[1,1,1],ai:r,dots:t.dots,state:e,isClickable:!0}),e},Pt=({state:e,component:t})=>{if(e.babylonjs.sceneRef){const n=e.babylonjs.sceneRef.getTransformNodeByUniqueId(parseInt(t.entity));null==n||n.dispose()}return e};let Mt,kt;!function(e){e.up="up",e.down="down",e.left="left",e.right="right",e.random="random"}(Mt||(Mt={})),function(e){let t;!function(e){e.onClick="BoxEvent-onClick",e.rotationEnd="BoxEvent-rotationEnd",e.rotateStart="BoxEvent-rotate"}(t||(t={})),e.Type=t}(kt||(kt={}));const Rt=n.p+"de1ab0613214552916d369d2014d1d95.png";var It=n(2646),Bt=n(8141),jt=n(8375);const qt=e=>e>2*Math.PI||e<-2*Math.PI?-2*Math.PI:e,Gt=Math.PI/2,Ut=({boxUniqueId:e,direction:t=Mt.random,color:n,texture:a,state:r,nextTurn:i})=>{const s=r.babylonjs.sceneRef;if(!s)return r;const l=s.getTransformNodeByUniqueId(parseInt(e)),c=(0,d.X)({state:r,name:o.box,entity:e});if(l&&c){r=(0,pt.w)({state:r,data:{...c,isAnimating:!0}});let o=Gt*(Math.random()>.5?1:-1),d=Math.random()>.5?"x":"y";switch(t){case Mt.down:o=-1*Gt,d="x";break;case Mt.up:o=1*Gt,d="x";break;case Mt.right:o=-1*Gt,d="y";break;case Mt.left:o=1*Gt,d="y";break;case Mt.random:o=Gt*(Math.random()>.5?1:-1),d=Math.random()>.5?"x":"y"}l.rotation.z=0;const u=[l.rotation.x,l.rotation.y,l.rotation.z],m=["x"===d?o:0,"y"===d?o:0,u[2]],y=[qt(m[0]+u[0]),qt(m[1]+u[1]),qt(m[2]+u[2])],g={type:kt.Type.rotationEnd,payload:{boxEntity:c.entity,texture:a,color:n,nextTurn:i}};r=(0,pt.w)({state:r,data:{name:p.f.animation,entity:e,isPlaying:!0,isFinished:!1,currentTime:0,wrapMode:It.f.WrapMode.once,timingMode:It.f.TimingMode.smooth,properties:[{path:"rotation",component:p.f.transform,entity:e,keyframes:[{duration:500,timingFunction:"Linear",valueRange:[u,y],endFrameEvent:g}]}]}});const f=l.getChildren();f.slice(1,f.length).forEach((e=>{const t=s.getMeshByUniqueId(e.uniqueId);t&&Pe({mesh:t,color:n,texture:a,scene:s})}))}return r},At="38127445920450264";let Ot;!function(e){let t;!function(e){e.appearAnimationEnd="MarkerEvent-appearAnimationEnd"}(t||(t={})),e.Type=t}(Ot||(Ot={}));const Ft=(0,m.o)({entity:At,name:o.marker}),Wt=(Ft.getComponent,({state:e,data:t})=>{if(e.babylonjs.sceneRef){e=(0,jt.K)({state:e,name:p.f.material,entity:At,update:e=>({diffuseColor:t.color?[t.color[0],t.color[1],t.color[2],0]:e.diffuseColor})}),e=(0,jt.K)({state:e,entity:At,name:p.f.transform,update:e=>({position:t.position?[t.position[0],t.position[1],-1]:e.position})});const n={type:Ot.Type.appearAnimationEnd,payload:{}};e=(0,u.L)({state:e,data:{name:p.f.animation,entity:At,isPlaying:!0,isFinished:!1,currentTime:0,wrapMode:It.f.WrapMode.once,timingMode:It.f.TimingMode.smooth,properties:[{path:"scale",component:p.f.transform,entity:At,keyframes:[{duration:400,timingFunction:"Linear",valueRange:[[2,2,1],[.9,.9,1]],endFrameEvent:n}]},{path:"alpha",component:p.f.material,entity:At,keyframes:[{duration:400,timingFunction:"Linear",valueRange:[0,1]}]}]}})}return Ft.setComponent({state:e,data:t})});var Kt=n(9655);const Qt=({state:e,name:t})=>{const n=(0,Kt.C)({state:e,name:t});return n?Object.keys(n).reduce(((e,t)=>(0,vt.S)({state:e,entity:t})),e):e},zt=({state:e,event:t})=>(e=Se({state:e,data:{page:t.payload.newPage,round:0,grid:[],currentPlayer:"",playersQueue:[],boxRotationQueue:[],gameStarted:!1}}),e=Qt({name:o.box,state:e}),e=Qt({name:o.ai,state:e}),e=Qt({name:o.marker,state:e}),e=Qt({name:o.background,state:e}),e=Qt({name:o.logo,state:e}),e=Dt({state:e,page:t.payload.newPage}),tt("setUIState",e),e),Dt=({state:e,page:t})=>(t===i.mainMenu&&(e=(0,ft.L)({state:e,entity:wt}),e=(0,u.L)({state:e,data:{entity:wt,name:o.logo}})),e);var Nt=n(772);const Vt=(e,t,n)=>e&&e[n]?e[n][t]:void 0,Xt=e=>[e[1][0],e[0][1],e[1][2],e[2][1]],Ht=(e,[t,n])=>[[Vt(e,n-1,t-1),Vt(e,n,t-1),Vt(e,n+1,t-1)],[Vt(e,n-1,t),Vt(e,n,t),Vt(e,n+1,t)],[Vt(e,n-1,t+1),Vt(e,n,t+1),Vt(e,n+1,t+1)]],$t=({entity:e,state:t})=>{const n=Ee({state:t});return n?(0,pt.w)({state:t,data:{...n,boxRotationQueue:[...n.boxRotationQueue,e]}}):t},_t=e=>6===e?1:e+1,Yt=({state:e,ai:t,box:n})=>{Ee({state:e});const{entity:a}=n;let o=n.dots;return t&&(o=_t(n.dots),e=Ut({state:e,boxUniqueId:a,texture:Me({state:e,ai:t})[o],color:t.color,nextTurn:!0}),e=$t({entity:a,state:e})),(0,pt.w)({state:e,data:{...n,isAnimating:!0,player:(null==t?void 0:t.entity)||"",dots:o}})},Zt={emptyBox:50,preferEmptyBoxes:15,advancedAttack:7,adjacted:{playerMoreThanOponent:0,playerEqualToOponent:10,playerLessThanOponent:-10,playerMoreThanPlayer:-5,playerEqualToPlayer:-4,playerLessThanPlayer:-15,sixToSix:50,toBorder:0},diagonall:{playerMoreThanOponent:1,playerEqualToOponent:2,playerLessThanOponent:7,playerMoreThanPlayer:-5,playerEqualToPlayer:-4,playerLessThanPlayer:0,toBorder:0}},Jt={emptyBox:50,preferEmptyBoxes:15,advancedAttack:0,adjacted:{playerMoreThanOponent:0,playerEqualToOponent:2,playerLessThanOponent:-2,playerMoreThanPlayer:-1,playerEqualToPlayer:-1,playerLessThanPlayer:-2,sixToSix:2,toBorder:0},diagonall:{playerMoreThanOponent:1,playerEqualToOponent:1,playerLessThanOponent:2,playerMoreThanPlayer:-1,playerEqualToPlayer:-1,playerLessThanPlayer:0,toBorder:0}},en={emptyBox:50,preferEmptyBoxes:15,advancedAttack:0,adjacted:{playerMoreThanOponent:0,playerEqualToOponent:0,playerLessThanOponent:-2,playerMoreThanPlayer:-2,playerEqualToPlayer:0,playerLessThanPlayer:-2,sixToSix:2,toBorder:0},diagonall:{playerMoreThanOponent:5,playerEqualToOponent:0,playerLessThanOponent:5,playerMoreThanPlayer:-2,playerEqualToPlayer:0,playerLessThanPlayer:0,toBorder:0}},tn=({state:e,ai:t,preferEmptyBoxes:n})=>{const a=t.entity,o={[s.disabled]:en,[s.random]:en,[s.easy]:en,[s.medium]:Jt,[s.hard]:Zt}[t.level];let r=Ue({state:e});if(r=(({dataGrid:e,aIGridPoints:t})=>e.reduce(((e,n,a)=>(e[a]=n.reduce(((e,n,a)=>{const o=void 0===n.player?n.points+t.emptyBox:n.points;return e[a]={...n,points:o},e}),n),e)),e))({dataGrid:r,aIGridPoints:o}),r=(({dataGrid:e,currentPlayer:t,preferEmptyBoxes:n,aIGridPoints:a})=>e.reduce(((o,r,i)=>(o[i]=r.reduce(((o,r,s)=>{if(r.player!==t.entity&&void 0!==r.player)return o;const c=Ht(e,[i,s]),d=(({grid3x3:e,preferEmptyBoxes:t,currentPlayer:n,aIGridPoints:a})=>{const o=e[1][1];return Xt(e).reduce(((e,r)=>{if(!r)return e+a.adjacted.toBorder;const i=o.dots===r.dots?l.equal:o.dots>r.dots?l.more:l.less;if(r.player!==o.player&&void 0!==r.player){if(t&&void 0===o.player&&r.player===n.entity)return Math.random()>.5?e+a.preferEmptyBoxes:e;if(i===l.more){const t=o.dots-r.dots;return e+a.adjacted.playerMoreThanOponent-t}if(i===l.equal)return e+a.adjacted.playerEqualToOponent*o.dots;if(i===l.less){const t=o.dots-r.dots-r.dots;return e+a.adjacted.playerLessThanOponent*Math.abs(t)}}else{if(6===o.dots)return e;if(i===l.more)return e+a.adjacted.playerMoreThanPlayer;if(i===l.equal)return 6===r.dots&&6===o.dots?e+a.adjacted.sixToSix:e+a.adjacted.playerEqualToPlayer;if(i===l.less)return 6===r.dots?e+2*a.adjacted.playerLessThanPlayer:e+a.adjacted.playerLessThanPlayer}return e}),0)})({grid3x3:c,preferEmptyBoxes:n,currentPlayer:t,aIGridPoints:a})+(({grid3x3:e,preferEmptyBoxes:t,currentPlayer:n,aIGridPoints:a})=>{const o=e[1][1];return(e=>[e[0][0],e[0][2],e[2][0],e[2][2]])(e).reduce(((e,t)=>{if(!t)return e+a.diagonall.toBorder;const n=o.dots===t.dots?l.equal:o.dots>t.dots?l.more:l.less;if(t.player!==o.player&&void 0!==t.player){if(n===l.more)return e+a.diagonall.playerMoreThanOponent;if(n===l.equal)return 6===t.dots?e+-10*a.diagonall.playerEqualToOponent:e+a.diagonall.playerEqualToOponent;if(n===l.less)return 6===t.dots?e+2*a.diagonall.playerLessThanOponent:e+a.diagonall.playerLessThanOponent}else{if(6===o.dots)return e;if(n===l.more)return e+a.diagonall.playerMoreThanPlayer;if(n===l.equal)return e+a.diagonall.playerEqualToPlayer;if(n===l.less){const n=t.dots-o.dots;return e+a.diagonall.playerLessThanPlayer+n**2}}return e}),0)})({grid3x3:c,preferEmptyBoxes:n,currentPlayer:t,aIGridPoints:a});return o[s]={...r,points:r.points+d},o}),r),o)),e))({currentPlayer:t,dataGrid:r,preferEmptyBoxes:!!n,aIGridPoints:o}),!n)switch(t.level){case s.disabled:r=(({dataGrid:e})=>e.reduce(((e,t,n)=>(e[n]=t.reduce(((e,t,n)=>(e[n].player="-1",e)),t),e)),e))({dataGrid:r});break;case s.random:r=(({dataGrid:e,currentPlayer:t})=>e.reduce(((e,n,a)=>(e[a]=n.reduce(((e,n,a)=>(n.player!==t||void 0===n.player||(e[a]={...n,points:100*Math.random()}),e)),n),e)),e))({dataGrid:r,currentPlayer:a});break;case s.hard:r=(({dataGrid:e,currentPlayer:t})=>e.reduce(((n,a,o)=>(n[o]=a.reduce(((n,a,r)=>{if(a.player!==t)return n;const i=Ht(e,[o,r]),s=Xt(i);if(s.some((e=>6===(null==e?void 0:e.dots))))return n;const l=s.reduce(((n,o)=>{if(!o)return n;const r=void 0!==o.player&&o.player!==t,i=a.dots>=o.dots;if(r&&i&&(({currentPlayer:e,adjactedBox:t,dataGrid:n,position:[a,o]})=>{const r=Ht(n,[a,o]);return Xt(r).every((n=>void 0===n||n.player===e||void 0===n.player||n.dots<=t.dots))})({currentPlayer:t,adjactedBox:o,dataGrid:e,position:o.gridPosition})){const e=6/a.dots;n+=o.dots*Zt.advancedAttack/e}return n}),0);return n[r]={...a,points:a.points+l},n}),a),n)),e))({dataGrid:r,currentPlayer:a})}return(({currentPlayer:e,dataGrid:t})=>{let n=-1/0,a=[];t.forEach((t=>{t.forEach((t=>{const o=void 0===t.player,r=t.player===e;(o||r)&&(t.points>n&&(a=[]),t.points>=n&&(n=t.points,a.push(t)))}))}));const o=Math.floor(Math.random()*a.length);return a[o]})({currentPlayer:a,dataGrid:r})},nn=({playersQueue:e,index:t,state:n})=>{const a=(0,d.X)({state:n,name:o.ai,entity:e[t]});return null!=a&&a.active?a:nn({playersQueue:e,index:t>=e.length?0:t+1,state:n})},an=({state:e})=>{const t=Ee({state:e});if(!t)return;const n=t.playersQueue.findIndex((e=>t.currentPlayer===e));return nn({playersQueue:t.playersQueue,index:n+1,state:e})},on=({state:e,ai:t,component:n})=>{e=(0,pt.w)({state:e,data:{...t,active:!1}});const a=(0,Kt.C)({state:e,name:o.ai});return 1===Object.values(a||{}).reduce(((e,t)=>t.active?e+1:e),0)?(e=(0,pt.w)({state:e,data:{...n,gameStarted:!1}}),tt("setUIState",e),e):e=rn({state:e})},rn=({state:e})=>{const t=Ee({state:e});if(!t)return e;const{gameStarted:n,boxRotationQueue:a}=t;if(n&&0===a.length){const n=an({state:e});if(!n)return e;const a=(0,d.X)({name:o.ai,state:e,entity:n.entity});if(!a)return e;if(e=(0,pt.w)({state:e,data:{...t,currentPlayer:a.entity,moves:t.moves+1}}),a.active)if(a.human)0===(({state:e,ai:t})=>{const n=Ee({state:e});return(null==n?void 0:n.grid.reduce(((n,a)=>{const r=(0,d.X)({state:e,name:o.box,entity:a});return(null==r?void 0:r.player)===t.entity?n+1:n}),0))||0})({state:e,ai:a})&&(e=on({state:e,component:t,ai:a}));else{const n=tn({state:e,ai:a});n?(e=Wt({state:e,data:{color:a.color,position:[n.gridPosition[0]*St,n.gridPosition[1]*St]}}),e=Yt({box:n,state:e,ai:a}),e=$t({state:e,entity:n.entity})):e=on({state:e,component:t,ai:a})}}return tt("setUIState",e),e},sn=Math.PI/3,ln=({gridMaxSideLength:e,maxTime:t,direction:n})=>a=>{let o=0,r=Mt.up;switch(n){case"down":o=(e-a[1])/e,r=Mt.down;break;case"up":o=a[1]/e,r=Mt.up;break;case"left":o=(e-a[0])/e,r=Mt.left;break;case"right":o=a[0]/e,r=Mt.right}return{timeout:Math.sin(o*sn)*t,boxRotationDirection:r}},cn=e=>{let t=Mt.up;const n=[Math.abs(e[0]),Math.abs(e[1])],a=n[0]>n[1];return e[0]<0&&e[1]<0?t=a?Mt.left:Mt.down:e[0]>0&&e[1]<0?t=a?Mt.right:Mt.down:e[0]<0&&e[1]>0?t=a?Mt.left:Mt.up:e[0]>0&&e[1]>0&&(t=a?Mt.right:Mt.up),t},dn=({gridMaxSideLength:e,maxTime:t,direction:n})=>a=>{const o=[e/2,e/2],r=[o[0]-a[0],o[1]-a[1]],i=Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2)),s=Math.sqrt(Math.pow(o[0],2)+Math.pow(o[1],2));let l=0,c=Mt.up;switch(n){case"center":l=s-i,c=cn([r[0],r[1]]);break;case"outside":l=i,c=cn([-r[0],-r[1]])}return{timeout:Math.sin(l/s*sn)*t,boxRotationDirection:c}},un=({state:e,game:t})=>{e=(({state:e,ai:t})=>{e=Qt({state:e,name:o.ai});const n=Ee({state:e});return n&&(e=(0,pt.w)({state:e,data:{...n,playersQueue:t.map((({entity:e})=>e))}})),t.reduce(((e,t)=>(e=(0,ft.L)({state:e,entity:t.entity}),(0,u.L)({state:e,data:t}))),e)})({state:e=Array.from({length:8}).reduce(((e,t,n)=>Array.from({length:8}).reduce(((e,t,a)=>{const r=yt().toString();e=(0,ft.L)({state:e,entity:r}),e=(0,u.L)({state:e,data:{name:o.box,entity:r,isAnimating:!1,dots:0,gridPosition:[a,n],player:void 0}});const i=Ee({state:e});return i?Se({state:e,data:{...i,grid:[...i.grid,r]}}):e}),e)),e),ai:t.customLevelSettings.players.map((e=>({...e,level:t.customLevelSettings.difficulty})))});const{center:n,cameraDistance:a}=(({state:e})=>{const t=Ue({state:e}),n=t[0]?1.2*t[0].length:1,a=1.2*t.length;return{width:n,height:a,center:[(n-1-.2)/2,(a-1-.2)/2],cameraDistance:(n>a?n:a)/2+.2}})({state:e});return Et({state:e,data:{position:[n[0],n[1]],distance:a}})},pn=({state:e})=>{var t,n;const a=Ee({state:e});if(!a)return e;e=un({state:e,game:a}),e=Se({state:e,data:{currentPlayer:null===(t=an({state:e}))||void 0===t?void 0:t.entity}});const r=Ee({state:e});null!=r&&r.customLevelSettings.quickStart&&(e=(({state:e})=>{const t=Ee({state:e}),n=(null==t?void 0:t.grid.length)||1,a=n-n%((null==t?void 0:t.customLevelSettings.players.length)||1);return Array.from({length:2*a}).reduce((e=>{const t=Ee({state:e}),n=(0,d.X)({state:e,name:o.ai,entity:(null==t?void 0:t.currentPlayer)||""});if(!t||!n)return e;const a=tn({state:e,ai:n,preferEmptyBoxes:!0});if(!a)return e;e=(0,pt.w)({state:e,data:{...a,player:n.entity,dots:_t(a.dots)}});const r=an({state:e});return(0,pt.w)({state:e,data:{...t,currentPlayer:(null==r?void 0:r.entity)||""}})}),e)||e})({state:e})),(({state:e})=>{const t=Ee({state:e}),n=Math.sqrt((null==t?void 0:t.grid.length)||1)-1,a=2e3,r=[dn({gridMaxSideLength:n,maxTime:a,direction:"center"}),dn({gridMaxSideLength:n,maxTime:a,direction:"outside"}),ln({gridMaxSideLength:n,maxTime:a,direction:"left"}),ln({gridMaxSideLength:n,maxTime:a,direction:"right"}),ln({gridMaxSideLength:n,maxTime:a,direction:"down"}),ln({gridMaxSideLength:n,maxTime:a,direction:"up"})],i=r[Math.floor(r.length*Math.random())];null==t||t.grid.forEach((t=>{const n=(0,d.X)({state:e,entity:t,name:o.box}),a=(0,d.X)({state:e,entity:(null==n?void 0:n.player)||"",name:o.ai});if(n&&a){const o=i(n.gridPosition),r=o.timeout+500*Math.random();setTimeout((()=>{(0,Ge.Kn)({type:kt.Type.rotateStart,payload:{color:a.color,texture:Me({state:e,ai:a})[n.dots],direction:o.boxRotationDirection,boxEntity:t}})}),r)}}))})({state:e}),e=Se({state:e,data:{gameStarted:!0,page:i.customLevel}});const s=(0,d.X)({state:e,name:o.ai,entity:(null===(n=Ee({state:e}))||void 0===n?void 0:n.currentPlayer)||""});if(s&&!s.human){const t=tn({state:e,ai:s});t&&(e=Yt({box:t,state:e,ai:s}))}return e=(0,ft.L)({state:e,entity:At}),e=(0,u.L)({state:e,data:{entity:At,name:o.marker,color:[1,1,1],position:[0,0]}}),tt("setUIState",e),s&&setTimeout((()=>{var t;(0,Ge.Kn)({type:Ce.Type.shakeAiBoxes,payload:{moves:(null===(t=Ee({state:e}))||void 0===t?void 0:t.moves)||0,ai:s}})}),2e3),e},mn=({state:e,event:t})=>{switch(t.type){case Ae.tP.Type.resize:return(({state:e})=>Et({state:e,data:{}}))({state:e,event:t});case xt.Type.rotateRandomLogoBox:return(({state:e})=>{const t=e.babylonjs.sceneRef,n=Tt({state:e}),a=Ee({state:e});if(!n||!t||!a)return e;const o=(()=>{const e=gt.flat().filter((e=>""!==e));return e[Math.floor(e.length*Math.random())]})(),r=(()=>{const e=Math.floor(pe.length*Math.random());return pe[e]})(),s=(()=>{const e=[We,...it().map((({color:e})=>e))];return e[Math.floor(e.length*Math.random())]})();return e=Ut({state:e,boxUniqueId:o,texture:r,color:s,nextTurn:!1}),a.page===i.mainMenu&&setTimeout((()=>{(0,Ge.Kn)({type:xt.Type.rotateRandomLogoBox,payload:{}})}),500*Math.random()+500),e})({state:e,event:t});case Ce.Type.startCustomLevel:return pn({state:e,event:t});case Ce.Type.playerClick:return(({state:e,event:t})=>{const n=Ee({state:e});if(!n)return e;const{currentPlayer:a,gameStarted:r,boxRotationQueue:i}=n,s=(0,d.X)({state:e,name:o.box,entity:t.payload.boxEntity}),l=void 0===(null==s?void 0:s.player)||(null==s?void 0:s.player)===a;if(r&&0===i.length&&l){const t=(0,d.X)({name:o.ai,state:e,entity:a});s&&null!=t&&t.human&&(e=Wt({state:e,data:{color:t.color,position:[s.gridPosition[0]*St,s.gridPosition[1]*St]}}),e=Yt({box:s,state:e,ai:t}))}return e})({state:e,event:t});case Ce.Type.cleanScene:return zt({state:e,event:t});case Ce.Type.changePlayers:return(({state:e})=>{var t,n;const a=Ee({state:e});if(!a)return e;const o=8===(null===(t=a.customLevelSettings.players)||void 0===t?void 0:t.length)?2:(null===(n=a.customLevelSettings.players)||void 0===n?void 0:n.length)+1;return e=Se({state:e,data:{customLevelSettings:{...a.customLevelSettings,players:it().slice(0,o)}}}),tt("setUIState",e),at(e),e})({state:e,event:t});case Ce.Type.changeDifficulty:return(({state:e})=>{const t=Ee({state:e});if(!t)return e;const n=[s.easy,s.medium,s.hard],a=n.findIndex((e=>e===t.customLevelSettings.difficulty)),o=-1===a?n[0]:n[a+1]??n[0];return e=Se({state:e,data:{customLevelSettings:{...t.customLevelSettings,difficulty:o}}}),tt("setUIState",e),at(e),e})({state:e,event:t});case Ce.Type.changeQuickStart:return(({state:e})=>{const t=Ee({state:e});return t?(e=Se({state:e,data:{customLevelSettings:{...t.customLevelSettings,quickStart:!t.customLevelSettings.quickStart}}}),tt("setUIState",e),at(e),e):e})({state:e,event:t});case Ce.Type.changeColorBlindMode:return(({state:e})=>{const t=Ee({state:e});return t?(e=Se({state:e,data:{colorBlindMode:!t.colorBlindMode}}),tt("setUIState",e),at(e),e):e})({state:e,event:t});case Ce.Type.changeMapType:return(({state:e})=>(tt("setUIState",e),at(e),e))({state:e,event:t});case Ce.Type.showNewVersion:return(({state:e})=>Se({state:e,data:{newVersionAvailable:!0}}))({state:e,event:t});case Ce.Type.reload:return(({state:e})=>(window.location.reload(),e))({state:e,event:t});case Ce.Type.shakeAiBoxes:return(({state:e,event:{payload:{ai:t,moves:n}}})=>{const a=Ee({state:e});return null==a||a.grid.forEach((n=>{const a=(0,d.X)({state:e,name:o.box,entity:n});(null==a?void 0:a.player)===t.entity&&(0,d.X)({state:e,name:p.f.transform,entity:n})&&Math.PI})),e})({state:e,event:t});case Ce.Type.playAgainCustomLevel:return e=zt({state:e,event:{type:Ce.Type.cleanScene,payload:{newPage:i.customLevel}}}),pn({state:e,event:{type:Ce.Type.startCustomLevel,payload:{}}});case kt.Type.rotationEnd:return(({state:e,event:t})=>{const n=e.babylonjs.sceneRef,{boxEntity:a,texture:r,color:i,nextTurn:s}=t.payload,l=(0,d.X)({state:e,name:o.box,entity:a}),c=(0,d.X)({state:e,name:p.f.transform,entity:a});if(!l||!n||!c)return e;e=(({entity:e,state:t})=>{const n=Ee({state:t});return n?(0,pt.w)({state:t,data:{...n,boxRotationQueue:n.boxRotationQueue.filter((t=>t!==e))}}):t})({entity:l.entity,state:e}),e=(0,pt.w)({state:e,data:{...c,rotation:[0,0,0]}});const u=n.getTransformNodeByUniqueId(parseInt(l.entity));u&&u.getChildren().forEach((e=>{const t=n.getMeshByUniqueId(e.uniqueId);t&&Pe({mesh:t,color:i,texture:r,scene:n})})),e=(0,pt.w)({state:e,data:{...l,isAnimating:!1}});const m=Ee({state:e}),y=(0,d.X)({state:e,name:o.ai,entity:(null==l?void 0:l.player)||""});return s&&y&&m&&l&&(1===l.dots?e=(({state:e,ai:t,box:n})=>{const{gridPosition:[a,o]}=n,r=Ue({state:e});return[Vt(r,o,a-1),Vt(r,o,a+1),Vt(r,o-1,a),Vt(r,o+1,a)].filter((e=>void 0!==e)).reduce(((e,n,a)=>(e=Yt({ai:t,box:n,state:e}),$t({entity:n.entity,state:e}))),e)})({state:e,box:l,ai:y}):0===m.boxRotationQueue.length&&(e=rn({state:e}))),e})({state:e,event:t});case kt.Type.rotateStart:return(({state:e,event:t})=>Ut({state:e,boxUniqueId:t.payload.boxEntity,texture:t.payload.texture,color:t.payload.color,direction:t.payload.direction,nextTurn:!1}))({state:e,event:t});case Ot.Type.appearAnimationEnd:return(({state:e})=>(0,jt.K)({state:e,entity:At,name:p.f.transform,update:()=>({position:[9999,9999,1]})}))({state:e,event:t})}return e};var yn=n(4155);const gn=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function fn(e,t){navigator.serviceWorker.register(e).then((e=>{e.onupdatefound=()=>{const n=e.installing;null!=n&&(n.onstatechange=()=>{"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((e=>{console.error("Error during service worker registration:",e)}))}yn.env.PUBLIC_URL="/kostki";var hn=n(3935),vn=n(7294),bn=n(6744);const{styled:wn,css:xn}=(0,bn.Th)({theme:{colors:{outline:"#595cff"},space:{},fontSizes:{},fonts:{},fontWeights:{},lineHeights:{},letterSpacings:{},sizes:{},borderWidths:{},borderStyles:{},radii:{},shadows:{},zIndices:{modal:1},transitions:{}},media:{bp1:"(min-width: 1024px)"}}),Cn=wn("button",{border:"5px solid black",background:"white",padding:"20px 15px",fontSize:"1.5rem",whiteSpace:"nowrap",cursor:"pointer",transition:"0.2s transform",pointerEvents:"auto","&:hover":{transform:"scale(1.05)"},"&:focus":{transform:"scale(0.98)"}}),Tn=wn("div",{display:"flex"}),En=wn("div",{display:"grid",maxWidth:"1920px",margin:"0 auto",padding:"0.5rem"}),Sn=wn("div",{color:"Black",fontSize:"1.5rem"});let Ln;const Pn=()=>{const[e,t]=(0,vn.useState)(void 0);return(0,vn.useEffect)((()=>{const e=e=>{e&&(Ln=e,t(e))};return((e,t)=>{document.addEventListener("setUIState",(e=>t(e.detail)))})(0,e),()=>{((e,t)=>{document.removeEventListener("setUIState",t)})(0,e)}}),[]),e||Ln},Mn=()=>{const e=Pn(),t=e&&Ee({state:e});return vn.createElement(En,{css:{gridTemplateRows:"20% 70% 10%",gridTemplateColumns:"20% 60% 20%",flex:1}},vn.createElement(Tn,{css:{flexDirection:"column",justifyContent:"center",alignItems:"center",gridRow:"2 / 2",gridColumn:"2 / 3"}},vn.createElement(Cn,{css:{maxWidth:"500px",width:"100%"},onClick:()=>{(0,Ge.Kn)({type:Ce.Type.cleanScene,payload:{newPage:i.customLevelSettings}})}},"Start"),vn.createElement(Cn,{css:{marginTop:"100px",maxWidth:"500px",width:"100%"},onClick:()=>{(0,Ge.Kn)({type:Ce.Type.cleanScene,payload:{newPage:i.customLevelSettings}})}},"Custom Level")),vn.createElement(Sn,{css:{flexDirection:"column",justifyContent:"center",gridRow:"3 / 4",gridColumn:"3 / 3",color:"white",fontSize:"1rem"}},null==t?void 0:t.version))},kn=e=>{var t;"Tab"===e.key&&(null===(t=document.body)||void 0===t||t.classList.add("enable-outline"))},Rn=()=>{var e;null===(e=document.body)||void 0===e||e.classList.remove("enable-outline")},In=wn("div",{display:"grid"}),Bn=()=>vn.createElement("svg",{width:"40",height:"40",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{margin:"-9px"}},vn.createElement("path",{d:"M11.4669 3.72684C11.7558 3.91574 11.8369 4.30308 11.648 4.59198L7.39799 11.092C7.29783 11.2452 7.13556 11.3467 6.95402 11.3699C6.77247 11.3931 6.58989 11.3355 6.45446 11.2124L3.70446 8.71241C3.44905 8.48022 3.43023 8.08494 3.66242 7.82953C3.89461 7.57412 4.28989 7.55529 4.5453 7.78749L6.75292 9.79441L10.6018 3.90792C10.7907 3.61902 11.178 3.53795 11.4669 3.72684Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"})),jn=()=>vn.createElement("svg",{width:"40",height:"40",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{margin:"-9px"}},vn.createElement("path",{d:"M11.7816 4.03157C12.0062 3.80702 12.0062 3.44295 11.7816 3.2184C11.5571 2.99385 11.193 2.99385 10.9685 3.2184L7.50005 6.68682L4.03164 3.2184C3.80708 2.99385 3.44301 2.99385 3.21846 3.2184C2.99391 3.44295 2.99391 3.80702 3.21846 4.03157L6.68688 7.49999L3.21846 10.9684C2.99391 11.193 2.99391 11.557 3.21846 11.7816C3.44301 12.0061 3.80708 12.0061 4.03164 11.7816L7.50005 8.31316L10.9685 11.7816C11.193 12.0061 11.5571 12.0061 11.7816 11.7816C12.0062 11.557 12.0062 11.193 11.7816 10.9684L8.31322 7.49999L11.7816 4.03157Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"})),qn=()=>{var e;const t=Pn(),n=t&&Ee({state:t});return n?vn.createElement(En,{css:{gridTemplateRows:"3fr 1fr 1fr",gridTemplateColumns:"1fr 1fr",gridGap:"1rem",flex:1}},vn.createElement(Tn,{css:{flexDirection:"column",justifyContent:"center",gridRow:"1 / 1",gridColumn:"1 / 3"}},"Select level (todo)"),vn.createElement(In,{css:{gridTemplateRows:"1fr 1fr 1fr 1fr",gridTemplateColumns:"1fr","@bp1":{gridTemplateRows:"1fr 1fr",gridTemplateColumns:"1fr 1fr"},gridGap:"1rem",gridRow:"2 / 2",gridColumn:"1 / 3"}},vn.createElement(Cn,{css:{display:"flex",justifyContent:"space-between",gridRow:"1 / 1",gridColumn:"1 / 1",alignSelf:"center"},onClick:()=>(0,Ge.Kn)({type:Ce.Type.changeDifficulty,payload:{}})},vn.createElement("div",null,"Difficulty"),vn.createElement("div",null,(e=>{switch(e){case s.disabled:return"Disabled";case s.random:return"Random";case s.easy:return"Easy";case s.medium:return"Medium";case s.hard:return"Hard"}})(n.customLevelSettings.difficulty))),vn.createElement(Cn,{css:{display:"flex",justifyContent:"space-between",gridRow:"2 / 2",gridColumn:"1 / 1",alignSelf:"center","@bp1":{gridRow:"1 / 1",gridColumn:"2 / 2"}},onClick:()=>(0,Ge.Kn)({type:Ce.Type.changePlayers,payload:{}})},vn.createElement("div",null,"Players"),vn.createElement("div",null,null===(e=n.customLevelSettings.players)||void 0===e?void 0:e.length)),vn.createElement(Cn,{css:{display:"flex",justifyContent:"space-between",gridRow:"3 / 3",gridColumn:"1 / 1",alignSelf:"center","@bp1":{gridRow:"2 / 2",gridColumn:"1 / 1"}},onClick:()=>(0,Ge.Kn)({type:Ce.Type.changeQuickStart,payload:{}})},vn.createElement("div",null,"Quick Start"),vn.createElement("div",null,n.customLevelSettings.quickStart?vn.createElement(Bn,null):vn.createElement(jn,null))),vn.createElement(Cn,{css:{display:"flex",justifyContent:"space-between",gridRow:"4 / 4",gridColumn:"1 / 1",alignSelf:"center","@bp1":{gridRow:"2 / 2",gridColumn:"2 / 2"}},onClick:()=>(0,Ge.Kn)({type:Ce.Type.changeColorBlindMode,payload:{}})},vn.createElement("div",null,"Color Blind Mode"),vn.createElement("div",null,n.colorBlindMode?vn.createElement(Bn,null):vn.createElement(jn,null)))),vn.createElement(Tn,{css:{flexDirection:"column",justifyContent:"center",gridRow:"3 / 3",gridColumn:"1 / 1"}},vn.createElement(Cn,{onClick:()=>(0,Ge.Kn)({type:Ce.Type.cleanScene,payload:{newPage:i.mainMenu}})},"Back")),vn.createElement(Tn,{css:{flexDirection:"column",justifyContent:"center",gridRow:"3 / 3",gridColumn:"2 / 2"}},vn.createElement(Cn,{onClick:()=>(0,Ge.Kn)({type:Ce.Type.startCustomLevel,payload:{}})},"Start"))):null},Gn=()=>vn.createElement("svg",{width:"100%",height:"100%",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},vn.createElement("path",{d:"M1.5 3C1.22386 3 1 3.22386 1 3.5C1 3.77614 1.22386 4 1.5 4H13.5C13.7761 4 14 3.77614 14 3.5C14 3.22386 13.7761 3 13.5 3H1.5ZM1 7.5C1 7.22386 1.22386 7 1.5 7H13.5C13.7761 7 14 7.22386 14 7.5C14 7.77614 13.7761 8 13.5 8H1.5C1.22386 8 1 7.77614 1 7.5ZM1 11.5C1 11.2239 1.22386 11 1.5 11H13.5C13.7761 11 14 11.2239 14 11.5C14 11.7761 13.7761 12 13.5 12H1.5C1.22386 12 1 11.7761 1 11.5Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"})),Un=wn("div",{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"auto"}),An=wn("div",{border:"5px solid black",background:"white"}),On=({children:e,css:t})=>vn.createElement(Un,null,vn.createElement(An,{css:t},e)),Fn=({ai:e})=>vn.createElement(Tn,{css:{flexDirection:"column"}},e.map((({entity:e,name:t,color:n,hasCurrentTurn:a,active:o})=>vn.createElement(Tn,{key:e,css:{alignItems:"center",padding:"0.125rem",paddingRight:"1rem",backgroundColor:a?"rgba(255,255,255,0.6)":""}},vn.createElement(Tn,{css:{position:"relative",width:"0.5rem",height:"0.5rem",border:"0.125rem solid black","@bp1":{width:"2rem",height:"2rem",border:"0.25rem solid black"},marginRight:"0.5rem",backgroundColor:`rgb(${255*n[0]}, ${255*n[1]}, ${255*n[2]})`}}),vn.createElement(Sn,{css:{fontSize:"0.75rem",textDecoration:o?"":"line-through","@bp1":{fontSize:"1.5rem"}}},t))))),Wn=({onClose:e})=>vn.createElement(On,{css:{width:"70%",height:"40%",display:"flex",flexDirection:"column",justifyContent:"space-around"}},vn.createElement(Sn,{css:{textAlign:"center"}},"Are you sure you want to finish the game?"),vn.createElement(Tn,{css:{justifyContent:"space-evenly"}},vn.createElement(Cn,{onClick:()=>{e(!1)}},"No"),vn.createElement(Cn,{onClick:()=>{(0,Ge.Kn)({type:Ce.Type.cleanScene,payload:{newPage:i.mainMenu}})}},"Yes"))),Kn=()=>vn.createElement(On,{css:{width:"70%",height:"40%",display:"flex",flexDirection:"column",justifyContent:"space-around"}},vn.createElement(Sn,{css:{textAlign:"center"}},"You lost"),vn.createElement(Tn,{css:{justifyContent:"space-evenly"}},vn.createElement(Cn,{onClick:()=>{(0,Ge.Kn)({type:Ce.Type.cleanScene,payload:{newPage:i.mainMenu}})}},"Back to main menu"),vn.createElement(Cn,{onClick:()=>{(0,Ge.Kn)({type:Ce.Type.playAgainCustomLevel,payload:{}})}},"Play again"))),Qn=()=>vn.createElement(On,{css:{width:"70%",height:"40%",display:"flex",flexDirection:"column",justifyContent:"space-around"}},vn.createElement(Sn,{css:{textAlign:"center"}},"You won"),vn.createElement(Tn,{css:{justifyContent:"space-evenly"}},vn.createElement(Cn,{onClick:()=>{(0,Ge.Kn)({type:Ce.Type.cleanScene,payload:{newPage:i.mainMenu}})}},"Back to main menu"),vn.createElement(Cn,{onClick:()=>{(0,Ge.Kn)({type:Ce.Type.playAgainCustomLevel,payload:{}})}},"Play again")));var zn;!function(e){e.playerWon="playerWon",e.playerLost="playerLost",e.gameInProgress="gameInProgress"}(zn||(zn={}));const Dn=()=>{const e=Pn(),t=e&&Ee({state:e}),n=e?(e=>{const t=Ee({state:e});return(null==t?void 0:t.playersQueue.map((t=>(0,d.X)({state:e,name:o.ai,entity:t}))).filter((e=>!!e))).map((e=>({entity:e.entity,color:e.color,active:e.active,human:e.human,hasCurrentTurn:(null==t?void 0:t.currentPlayer)===e.entity,name:e.human?"Player":"Computer"})))})(e):[],[a,r]=(0,vn.useState)(!1),i=t&&e?(({aiList:e,game:t,state:n})=>{if(!0===t.gameStarted)return zn.gameInProgress;const a=e.find((e=>e.human)),r=t.grid.reduce(((e,t)=>{const r=(0,d.X)({state:n,name:o.box,entity:t});return(null==r?void 0:r.player)===(null==a?void 0:a.entity)?e+1:e}),0);return 0===r||r===t.grid.length?zn.playerLost:zn.gameInProgress})({game:t,aiList:n,state:e}):zn.gameInProgress;return vn.createElement(En,{css:{gridTemplateRows:"4rem 1fr",gridTemplateColumns:"1fr 4rem",flex:1}},a&&vn.createElement(Wn,{onClose:()=>r(!1)}),i===zn.playerWon&&vn.createElement(Qn,null),i===zn.playerLost&&vn.createElement(Kn,null),vn.createElement(Tn,{css:{gridRow:"1 / 3",gridColumn:"1 / 1"}},vn.createElement(Fn,{ai:n})),vn.createElement(Cn,{css:{gridRow:"1 / 1",gridColumn:"2 / 2",display:"flex",alignContent:"center",alignItems:"center",padding:"0.75rem"},onClick:()=>{r(!0)}},vn.createElement(Gn,null)))},Nn=(0,bn.zY)({"*":{fontFamily:"Sans-serif",userSelect:"none"},".enable-outline *:focus":{outlineWidth:"10px",outlineStyle:"solid",outlineColor:"$outline"}}),Vn=({state:e})=>{var t;(0,vn.useEffect)((()=>(window.addEventListener("keydown",kn),()=>{window.removeEventListener("keydown",kn)})),[]),(0,vn.useEffect)((()=>(window.addEventListener("click",Rn),()=>{window.removeEventListener("click",Rn)})),[]),Nn();const n=Pn();switch(null===(t=Ee({state:n||e}))||void 0===t?void 0:t.page){case i.mainMenu:return vn.createElement(Mn,null);case i.customLevelSettings:return vn.createElement(qn,null);case i.customLevel:return vn.createElement(Dn,null);case void 0:return null}};var Xn=n(7307),Hn=(n(2920),n(2031)),$n=n(9469),_n=n(3607),Yn=n(2587),Zn=n(9509);const Jn=document.getElementById("game"),ea="humanPlayer",ta=new Xn.D(Jn,!0,{preserveDrawingBuffer:!0,stencil:!0,disableWebGL2Support:!1}),na=new Hn.x(ta);ta.runRenderLoop((()=>{na&&na.activeCamera&&na.render()}));const aa=new $n.x("UniversalCamera",new Re.P(0,0,-1),na);aa.mode=_n.V.ORTHOGRAPHIC_CAMERA;const oa=new Yn.e("light",new Re.P(0,0,1),na);oa.intensity=1,oa.diffuse=new Le.Wo(1,1,1),oa.specular=new Le.Wo(1,1,1),oa.groundColor=new Le.Wo(1,1,1);{"serviceWorker"in navigator&&(function(e){if("serviceWorker"in navigator){if(new URL(yn.env.PUBLIC_URL,window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(()=>{const t=`${yn.env.PUBLIC_URL}/service-worker.js`;gn?(function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((n=>{const a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((e=>{e.unregister().then((()=>{window.location.reload()}))})):fn(e,t)})).catch((()=>{console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):fn(t,e)}))}}({onUpdate:()=>{},onSuccess:()=>{}}),navigator.serviceWorker.addEventListener("message",(async e=>{if("workbox-broadcast-update"===e.data.meta){const{cacheName:t,updatedURL:n}=e.data.payload,a=await caches.open(t),o=await a.match(n);await(null==o?void 0:o.text()),(0,Ge.Kn)({type:Ce.Type.showNewVersion,payload:{}})}})));let e=(({scene:e,camera:t,Vector3:n})=>{let r=(0,Nt.y0)({scene:e,camera:t,Vector3:n,StandardMaterial:Ie.K,MeshBuilder:Be.V,Texture:y.x,Color3:Le.Wo});(0,Ge.Ib)(mn),r=(e=>(0,a.FI)({state:e,name:o.box,componentName:o.box,create:Lt,remove:Pt}))(r),r=(e=>(0,a.FI)({state:e,name:o.ai,componentName:o.ai}))(r),r=(e=>(0,a.FI)({state:e,name:o.game,componentName:o.game,create:we}))(r),r=(e=>(0,a.FI)({state:e,name:o.marker,componentName:o.marker,create:({state:e,component:t})=>{if(!e.babylonjs.sceneRef)return e;const n=1.4;e=(0,u.L)({state:e,data:(0,Bt.$e)({entity:t.entity,position:[9999,9999,9999],scale:[n,n,1]})});const a=yt();return e=(0,u.L)({state:e,data:{entity:t.entity,name:p.f.material,uniqueId:a,diffuseTexture:Rt,diffuseColor:[1,0,1,0]}}),(0,u.L)({state:e,data:{entity:t.entity,name:p.f.mesh,type:It.o.plane,uniqueId:a,width:n,height:n,updatable:!1,sideOrientation:0,materialEntity:[t.entity]}})},remove:({state:e})=>(0,vt.S)({state:e,entity:At})}))(r),r=(e=>(0,a.FI)({state:e,name:o.background,componentName:o.background,create:ct,tick:({state:e,component:t})=>{if(!e.babylonjs.sceneRef)return e;const n=e.babylonjs.sceneRef.getMeshByUniqueId(parseFloat(dt));return n&&n.material&&(n.material.setFloat("iTime",performance.now()/1e3+t.gradientTime),n.material.setVector2("iResolution",new Re.FM(window.innerWidth,window.innerHeight)),n.material.setFloats("iColors",Ze.flat())),e}}))(r),r=(e=>(0,a.FI)({state:e,name:o.logo,componentName:o.logo,create:ht,remove:bt}))(r),r=(0,ft.L)({state:r,entity:ea}),r=(0,u.L)({state:r,data:{entity:ea,name:o.ai,human:!0,level:s.hard,color:[0,0,1],textureSet:["","","","","","",""],active:!0}});const l=JSON.parse(localStorage.getItem(nt)||"null");return r=(0,ft.L)({state:r,entity:xe}),r=(0,u.L)({state:r,data:{version:"0.0.12",page:i.mainMenu,newVersionAvailable:!1,entity:xe,name:o.game,moves:0,grid:[],round:0,currentPlayer:ea,gameStarted:!1,playersQueue:[],boxRotationQueue:[],colorBlindMode:(null==l?void 0:l.colorBlindMode)||!1,customLevelSettings:{players:(null==l?void 0:l.players)||it().slice(0,4),difficulty:(null==l?void 0:l.difficulty)||s.medium,quickStart:(null==l?void 0:l.quickStart)||!0,mapType:(null==l?void 0:l.mapType)||""}}}),e&&(r=(0,pt.w)({state:r,data:{entity:Ae.lw,name:p.f.camera,position:[0,0],distance:5,...st(5,e)}})),r=(0,ft.L)({state:r,entity:dt}),r=(0,u.L)({state:r,data:{entity:dt,name:o.background,gradientTime:5e4*Math.random()}}),r=Dt({state:r,page:i.mainMenu}),r})({scene:na,camera:aa,Vector3:Re.P});if((({state:e})=>{hn.render(vn.createElement(vn.StrictMode,null,vn.createElement(Vn,{state:e})),document.getElementById("gameUi"))})({state:e}),e.babylonjs.sceneRef){const t=()=>{e=(0,Zn.P)({state:e})};e.babylonjs.sceneRef.registerBeforeRender(t)}window.addEventListener("resize",(()=>{(0,Ge.Kn)({type:Ae.tP.Type.resize,payload:{}}),ta.resize()}))}}},e=>{e.O(0,[216],(()=>(7268,e(e.s=7268)))),e.O()}]);